<!DOCTYPE html>
<html>
    <head>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script src="../vendors/scoped.js"></script>
        <script src="../vendors/beta-noscoped.js"></script>
        <script src="../vendors/betajs-browser-noscoped.js"></script>
        <script src="../dist/betajs-ui-noscoped.js"></script>
        <script src="../vendors/betajs-dynamics-noscoped.js"></script>
        <link rel="stylesheet" href="styles.css" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    </head>
    <body>
    	<div class="doodads noselect" ba-repeat="{{doodad::[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]}}">
	        <div class="doodad noselect"
	                                       ba-gesture:swipe="{{swipe_gesture_options}}"
	                                       ba-interaction:swipe="{{{data: doodad, options: swipe_interaction_options, sub: 'div:first-child'}}}">
	           <div class="inner noselect">
	               Doodad {{doodad}}
	           </div>
	        </div>
    	</div>
        <script>
        BetaJS.Dynamics.Dynamic.activate({
        	element: document.body,
        	attrs: {
                swipe_gesture_options: {
                    mouse_up_activate: false,
                    wait_time: 750,
                    wait_activate: false,
                    disable_x: -1,
                    disable_y: 10,
                    enable_x: 10,
                    enable_y: -1,
                    interaction: "swipe",
                    transition_event: function (element, host) {
                    	console.log("Swipe Gesture", host.data(), host.state()._current_state);
                    } 
                },
                swipe_actions: {
                    "other": {less: -1/4},
                    "archive": {greater: 1/4, less: 1/3},
                    "delete": {greater: 1/3}
                },
                swipe_interaction_options: {
                	type: "drag",
                    draggable_y: false,
                    start_event: null,
                    events: {
                    	"move": function (doodad, event) {
                            var element = event.element;
                            var parent = element.parent();
                            var x = parseInt(element.css("left"), 10);
                            var w = parseInt(element.css("width"), 10);
                            var a = {};
                            var actions = this.get("swipe_actions");
                            for (var cls in actions) {
                                a = actions[cls];
                                if ((!a.less || x <= w * a.less) && (!a.greater || x >= w * a.greater))
                                    parent.addClass(cls);
                                else
                                    parent.removeClass(cls);
                            }
                        },
                        "release": function (doodad, event) {
                            var element = event.element;
                            var parent = element.parent();
                            var x = parseInt(element.css("left"), 10);
                            var w = parseInt(element.css("width"), 10);
                            var actions = this.get("swipe_actions");
                            for (var cls in actions) {
                                a = actions[cls];
                                if ((!a.less || x <= w * a.less) && (!a.greater || x >= w * a.greater)) {
                                    event.source.abort();
                                    parent.slideUp();
                                }
                            }
                        }
                    }
                }
        	},
        	functions: {
        		click: function (doodad) {
        			alert("Click " + doodad);
        		}
        	}
        });
        </script>    
    </body>
</html>
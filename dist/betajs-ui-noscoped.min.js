/*!
betajs-ui - v1.0.3 - 2015-12-12
Copyright (c) Oliver Friedmann,Victor Lingenthal
MIT Software License.
*/
(function(){var a=this.subScope();a.binding("module","global:BetaJS.UI"),a.binding("base","global:BetaJS"),a.binding("browser","global:BetaJS.Browser"),a.binding("dynamics","global:BetaJS.Dynamics"),a.binding("jquery","global:jQuery"),a.define("module:",function(){return{guid:"ff8d5222-1ae4-4719-b842-1dedb9162bc0",version:"45.1449951913496"}}),a.assumeVersion("base:version",444),a.assumeVersion("browser:version",58),a.define("module:Elements.Animators",["base:Class","base:Objs"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(c,d,e,f){a.constructor.call(this),this._element=c,this._options=b.extend({callback_on_revert:!0,callback_on_complete:!0,auto_start:!0,auto_destroy:!0},d),this._callback=e,this._context=f,this._running=!1,this._options.auto_start&&this.start()},start:function(){this._running||(this._running=!0,this._start())},revert:function(){this._running&&(this._running=!1,this._revert())},complete:function(){this._running&&this._complete()},__callback:function(){this._callback.apply(this._context||this),this._options&&this._options.auto_destroy&&this.destroy()},_finished:function(){this.__callback()},_reverted:function(){this._options.callback_on_revert&&this.__callback()},_completed:function(){this._options.callback_on_complete&&this.__callback()},_start:function(){this._finished()},_revert:function(){this._reverted()},_complete:function(){this._completed()}}})}),a.define("module:Elements.DefaultAnimator",["module:Elements.Animators","base:Objs"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(c,d,e,f){d=b.extend({duration:250,styles:{},method:"swing"},d),a.constructor.call(this,c,d,e,f)},_start:function(){var a=this;this.__animate=this._element.animate(this._options.styles,this._options.duration,this._options.method,function(){a._finished()})},_revert:function(){this.__animate.stop(),this._reverted()},_complete:function(){this.__animate.stop(!0),this._completed()}}})}),a.define("module:Elements.ElementModifier",["base:Class","jquery:"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(c){a.constructor.call(this),this._element=b(c),this._css={},this._cls={}},css:function(a,b){return arguments.length<2?this._element.css.apply(this._element,arguments):this._element.css(a)===b?b:(a in this._css||(this._css[a]=this._element.get(0).style[a]),this._element.css(a,b),b)},csscls:function(a,b){var c=this._element.hasClass(a);return arguments.length<2?a:c===b?b:(a in this._cls||(this._cls[a]=c),b?this._element.addClass(a):this._element.removeClass(a),b)},removeClass:function(a){this._element.hasClass(a)&&(a in this._cls||(this._cls[a]=!0),this._element.addClass(a))},revert:function(){for(var a in this._css)this._element.css(a,this._css[a]);for(a in this._cls)this._cls[a]?this._element.addClass(a):this._element.removeClass(a)}}})}),a.define("module:Elements.ElementSupport",["base:Types","jquery:"],function(a,b){return{elementFromPoint:function(c,d,e){e=e||[],a.is_array(e)||(e=[e]);for(var f=[],g=0;g<e.length;++g)e[g]=b(e[g]),f.push(e[g].css("z-index")),e[g].css("z-index",-1);var h=document.elementFromPoint(c-window.pageXOffset,d-window.pageYOffset);for(g=0;g<e.length;++g)e[g].css("z-index",f[g]);return h},elementBoundingBox:function(a){a=b(a);var c=a.offset();return{left:c.left,top:c.top,right:c.left+a.outerWidth()-1,bottom:c.top+a.outerHeight()-1}},pointWithinElement:function(a,b,c){var d=this.elementBoundingBox(c);return d.left<=a&&a<=d.right&&d.top<=b&&b<=d.bottom},childContainingElement:function(a,c){for(a=b(a).get(0),c=b(c).get(0);c.parentNode!=a;){if(c==document.body)return null;c=c.parentNode}return c}}}),a.define("module:Events.Mouse",["browser:Info"],function(a){return{downEvent:a.isMobile()?"touchstart":"mousedown",moveEvent:a.isMobile()?"touchmove":"mousemove",upEvent:a.isMobile()?"touchend":"mouseup",clickEvent:a.isMobile()?"touchstart":"click",customCoords:function(a,b,c){if(a.originalEvent.touches&&a.originalEvent.touches.length){var d=a.originalEvent.touches;if(c){for(var e=[],f=0;f<d.length;++f)e.push({x:d[f][b+"X"],y:d[f][b+"Y"]});return e}return{x:d[0][b+"X"],y:d[0][b+"Y"]}}var g={x:a[b+"X"],y:a[b+"Y"]};return c?[g]:g},pageCoords:function(a,b){return this.customCoords(a,"page",b)},clientCoords:function(a,b){return this.customCoords(a,"client",b)},screenCoords:function(a,b){return this.customCoords(a,"screen",b)}}}),a.define("module:Events.Support",["base:Objs","base:Types","jquery:","module:Elements.ElementSupport"],function(a,b,c,d){return{dispatchElementEvent:function(b,c,d,e){b.dispatchEvent(new CustomEvent(c,a.extend({bubbles:!0,cancelable:!0,detail:d},e)))},dispatchElementsEvent:function(b,c,d,e){for(var f=0;f<b.length;++f)b[f].dispatchEvent(new CustomEvent(c,a.extend({bubbles:!1,cancelable:!0,detail:d},e)))},dispatchManualBubbleEvent:function(a,b,d,e,f){this.dispatchElementsEvent(c(a).parents().andSelf().filter(d),b,e,f)},dispatchPointsSeparatorEvent:function(a,c,e,f,g,h){e=e?b.is_array(e)?e:[e]:[],f=f?b.is_array(f)?f:[f]:[],this.dispatchManualBubbleEvent(a,c,function(){for(var a=0;a<e.length;++a)if(!d.pointWithinElement(e[a].x,e[a].y,this))return!1;for(a=0;a<f.length;++a)if(d.pointWithinElement(f[a].x,f[a].y,this))return!1;return!0},g,h)}}}),a.define("module:Hardware.MouseCoords",["base:Ids","base:Objs","jquery:","module:Events.Mouse"],function(a,b,c,d){return{__required:0,coords:{x:0,y:0},require:function(){if(0===this.__required){var e=this,f=[d.moveEvent,d.upEvent,d.downEvent];b.iter(f,function(b){c("body").on(b+"."+a.objectId(this),function(a){var b=d.pageCoords(a);b.x&&b.y&&(e.coords=b)})},this)}this.__required++},unrequire:function(){this.__required--,0===this.__required&&c("body").off("."+a.objectId(this))}}}),a.define("module:Interactions.Drag",["module:Interactions.ElementInteraction","module:Elements.ElementModifier","module:Elements.ElementSupport","module:Events.Support","module:Events.Mouse","module:Hardware.MouseCoords","base:Ids","base:Objs","base:Functions"],function(a,b,c,d,e,f,g,h,i,j){return a.extend({scoped:j},function(a){return{constructor:function(c,d,f){d=h.extend({start_event:e.downEvent,stop_event:e.upEvent,draggable_x:!0,draggable_y:!0,clone_element:!1,drag_original_element:!1,droppable:!1,remove_element_on_drop:!1,revertable:!0,draggable:function(){return!0}},d),a.constructor.call(this,c,d),this._host.initialize(this.cls.classname+"States.Idle"),this._modifier=new b(this._element),this.data=f},destroy:function(){this._modifier.revert(),this._modifier.destroy(),a.destroy.call(this)},_enable:function(){this._options.start_event&&this._element.on(this._options.start_event+"."+g.objectId(this),i.as_method(this.start,this))},_disable:function(){this._element.off("."+g.objectId(this)),this.stop()},start:function(){this._enabled&&this._host.state().next("Dragging")},stop:function(){this._enabled&&this._host.state().next("Stopping")},draggable:function(){return this._options.draggable.call(this._options.context,this)},abort:function(){this._enabled&&this._host.state().next("Idle")},dropped:function(a){this.trigger("dropped",a),this._host.state().next("Stopping",{immediately:!0}),this._options.remove_element_on_drop&&(this.element().remove(),this.destroy())},actionable_element:function(){var a=this._host.state()._cloned_element;return a?a:this._element},modifier:function(){return this._modifier},actionable_modifier:function(){var a=this._host.state()._cloned_modifier;return a?a:this._modifier},__eventData:function(){return{element:this.element(),actionable_element:this.actionable_element(),modifier:this.modifier(),actionable_modifier:this.actionable_modifier(),source:this,data:this.data,page_coords:f.coords,underneath:this.__underneath}},__triggerEvent:function(a){this.trigger(a,this.__eventData())},__triggerDomEvent:function(a){var b=this.__eventData(),e=c.elementFromPoint(b.page_coords.x,b.page_coords.y,this.actionable_element());e&&d.dispatchElementEvent(e,"drag-"+a,b)},__triggerDomMove:function(){var a=this.__eventData(),b=c.elementFromPoint(a.page_coords.x,a.page_coords.y,this.actionable_element());b&&(this.__old_coords&&this.__underneath&&this.__underneath!=b&&(d.dispatchPointsSeparatorEvent(b,"drag-enter",a.page_coords,this.__old_coords,a),d.dispatchPointsSeparatorEvent(this.__underneath,"drag-leave",this.__old_coords,a.page_coords,a)),d.dispatchElementEvent(b,"drag-hover",a)),this.__underneath=b,this.__old_coords=a.page_coords}}})}),a.define("module:Interactions.DragStates.Idle",["module:Interactions.State"],function(a,b){return a.extend({scoped:b},{_white_list:["Dragging"],trigger:function(a){this.parent().__triggerEvent(a)},triggerDom:function(a){this.parent().__triggerDomEvent(a)},triggerDomMove:function(){this.parent().__triggerDomMove()}})}),a.define("module:Interactions.DragStates.Dragging",["module:Interactions.DragStates.Idle","module:Hardware.MouseCoords","module:Elements.ElementModifier","module:Events.Mouse","jquery:"],function(a,b,c,d,e,f){return a.extend({scoped:f},{_white_list:["Stopping"],_persistents:["initial_element_coords","cloned_element","cloned_modifier","placeholder_cloned_element"],_start:function(){var a=this.parent().options();if(this._page_coords=b.coords,a.clone_element){this._initial_element_coords={x:this.element().offset().left,y:this.element().offset().top};var f=this.element().css("z-index"),g=this.element().width(),h=this.element().height();a.drag_original_element?(this._placeholder_cloned_element=this.element().clone(),this._cloned_element=this.element().replaceWith(this._placeholder_cloned_element)):this._cloned_element=this.element().clone(),this._cloned_modifier=new c(this._cloned_element),this._cloned_modifier.css("position","absolute"),this._cloned_modifier.css("width",g+"px"),this._cloned_modifier.css("height",h+"px"),this._cloned_modifier.css("z-index",f+1),this._cloned_modifier.css("left",this._initial_element_coords.x+"px"),this._cloned_modifier.css("top",this._initial_element_coords.y+"px"),e("body").append(this._cloned_element)}else{var i=this.parent().modifier();if(i.css("position","relative"),this._initial_element_coords={},a.draggable_x){var j=i.css("left");"auto"!==j&&j||i.css("left","0px"),this._initial_element_coords.x=parseInt(i.css("left"),10)}if(a.draggable_y){var k=i.css("top");"auto"!==k&&k||i.css("top","0px"),this._initial_element_coords.y=parseInt(i.css("top"),10)}}this.trigger("start"),this.on("body",d.moveEvent,this.__dragging),a.stop_event&&this.on("body",a.stop_event,function(){a.droppable&&this.triggerDom("drop"),"next"in this&&this.next("Stopping",{released:!0})})},__dragging:function(a){a.preventDefault();var b=d.pageCoords(a),c={x:b.x-this._page_coords.x,y:b.y-this._page_coords.y};this._page_coords=b;var e=this.parent().actionable_modifier();this.options().draggable_x&&e.css("left",parseInt(e.css("left"),10)+c.x+"px"),this.options().draggable_y&&e.css("top",parseInt(e.css("top"),10)+c.y+"px"),this.trigger("move"),this.triggerDomMove()}})}),a.define("module:Interactions.DragStates.Stopping",["module:Interactions.DragStates.Idle","module:Elements.DefaultAnimator"],function(a,b,c){return a.extend({scoped:c},function(a){return{_white_list:["Idle"],_locals:["initial_element_coords","cloned_element","cloned_modifier","immediately","released","placeholder_cloned_element"],_immediately:null,_start:function(){this.trigger("stopping"),this.triggerDom("stop");var a=this.options();if(!a.revertable||this._immediately)return this._released&&this.trigger("release"),void this.next("Idle");var c={};a.draggable_x&&(c.left=this._initial_element_coords.x+"px"),a.draggable_y&&(c.top=this._initial_element_coords.y+"px"),this.__animation=new b(this.parent().actionable_element(),{styles:c},function(){this.__animation&&this.next("Idle")},this),this._released&&this.trigger("release")},_end:function(){if(this.__animation){var b=this.__animation;this.__animation=null,b.complete()}this._cloned_modifier&&(this._cloned_modifier.revert(),this._cloned_modifier.destroy()),this._cloned_element&&(this._placeholder_cloned_element&&(this._cloned_element=this._placeholder_cloned_element.replaceWith(this._cloned_element)),this._cloned_element.remove()),this.parent().modifier().revert(),this.trigger("stop"),a._end.call(this)}}})}),a.define("module:Interactions.Drop",["module:Interactions.ElementInteraction","base:Objs","module:Elements.ElementSupport","module:Elements.ElementModifier"],function(a,b,c,d,e){return a.extend({scoped:e},function(a){return{constructor:function(c,e,f){e=b.extend({droppable:function(){return!0},context:this,bounding_box:function(a){return a}},e),a.constructor.call(this,c,e),this._host.initialize(this.cls.classname+"States.Idle"),this._modifier=new d(this._element),this.data=f},destroy:function(){this._modifier.revert(),this._modifier.destroy(),this._host.destroy(),a.destroy.call(this)},_enable:function(){this._host.state().next("Idle")},_disable:function(){this._host.state().next("Disabled")},modifier:function(){return this._modifier},__eventData:function(){return{element:this.element(),modifier:this.modifier(),target:this,data:this.data,source:this._host.state()._drag_source?this._host.state()._drag_source:null}},__triggerEvent:function(a){this.trigger(a,this.__eventData())},droppable:function(a){return this._options.droppable.call(this._options.context,a,this)},_is_hovering:function(a){if(!a.source.options().droppable)return!1;var b=c.elementBoundingBox(this.element());b=this._options.bounding_box.call(this._options.context,b);var d=a.page_coords;return b.left<=d.x&&d.x<=b.right&&b.top<=d.y&&d.y<=b.bottom}}})}),a.define("module:Interactions.DropStates.Disabled",["module:Interactions.State"],function(a,b){return a.extend({scoped:b},{_white_list:["Idle"],trigger:function(a){this.parent().__triggerEvent(a)}})}),a.define("module:Interactions.DropStates.Idle",["module:Interactions.DropStates.Disabled"],function(a,b){return a.extend({scoped:b},{_white_list:["Hover","InvalidHover","Disabled"],_start:function(){this.on(this.element(),"drag-hover",function(a){if(this.parent()._enabled){var b=a.originalEvent.detail;this.parent()._is_hovering(b)&&this.next(this.parent().droppable(b)?"Hover":"InvalidHover",{drag_source:b})}})}})}),a.define("module:Interactions.DropStates.Hover",["module:Interactions.DropStates.Disabled"],function(a,b){return a.extend({scoped:b},function(a){return{_white_list:["Idle","Disabled","Dropping"],_persistents:["drag_source"],_start:function(){this.trigger("hover"),this.on(this.element(),"drag-hover",function(a){this._drag_source=a.originalEvent.detail,this.parent()._is_hovering(this._drag_source)||this.next("Idle")}),this.on(this.element(),"drag-stop drag-leave",function(a){this._drag_source=a.originalEvent.detail,this.next("Idle")}),this.on(this.element(),"drag-drop",function(a){this._drag_source=a.originalEvent.detail,this.next("Dropping")})},_end:function(){this.trigger("unhover"),this.parent().modifier().revert(),a._end.call(this)}}})}),a.define("module:Interactions.DropStates.InvalidHover",["module:Interactions.DropStates.Disabled"],function(a,b){return a.extend({scoped:b},function(a){return{_white_list:["Idle","Disabled"],_persistents:["drag_source"],_start:function(){this.trigger("hover-invalid"),this.on(this.element(),"drag-hover",function(a){this._drag_source=a.originalEvent.detail,this.parent()._is_hovering(this._drag_source)||this.next("Idle")}),this.on(this.element(),"drag-drop drag-stop drag-leave",function(a){this._drag_source=a.originalEvent.detail,this.next("Idle")})},_end:function(){this.trigger("unhover"),this.parent().modifier().revert(),a._end.call(this)}}})}),a.define("module:Interactions.DropStates.Dropping",["module:Interactions.DropStates.Disabled"],function(a,b){return a.extend({scoped:b},{_white_list:["Idle","Disabled"],_persistents:["drag_source"],_start:function(){this.trigger("dropped"),this._drag_source.source.dropped(this.parent()),this.next("Idle")}})}),a.define("module:Interactions.DropList",["module:Interactions.ElementInteraction","module:Elements.ElementSupport","base:Objs","jquery:"],function(a,b,c,d,e){return a.extend({scoped:e},function(a){return{constructor:function(b,e,f){e=c.extend({droppable:function(){return!0},context:this,bounding_box:function(a){return a},floater:null},e),a.constructor.call(this,b,e),this._host.initialize(this.cls.classname+"States.Idle"),this.data=f,this._floater=d(this._options.floater),this._floater.css("display","none")},destroy:function(){this._host.destroy(),a.destroy.call(this)},_enable:function(){this._host.state().next("Idle")},_disable:function(){this._host.state().next("Disabled")},__eventData:function(){return{index:this._floater.index(),element:this.element(),target:this,data:this.data,source:this._host.state()._drag_source?this._host.state()._drag_source:null}},__triggerEvent:function(a){this.trigger(a,this.__eventData())},droppable:function(a){return this._options.droppable.call(this._options.context,a,this)},__update_floater:function(a){this._floater.css("display","none");var c=a.page_coords,e=b.childContainingElement(this.element(),a.underneath);if(e){if(e=d(e),e.get(0)==this._floater.get(0))return void this._floater.css("display","");var f=b.elementBoundingBox(e);f=this._options.bounding_box.call(this._options.context,f),f.top<=c.y&&c.y<=f.bottom||(this._floater.css("display",""),c.y<f.top?this._floater.insertBefore(e):this._floater.insertAfter(e))}},insertAt:function(a,b){var c=this.element().children().size();0>b&&(b=Math.max(0,c+1+b)),this.element().append(a),c>b&&this.element().children().eq(b).before(this.element().children().last())}}})}),a.define("module:Interactions.DropListStates.Disabled",["module:Interactions.State"],function(a,b){return a.extend({scoped:b},{_white_list:["Idle"],trigger:function(a){this.parent().__triggerEvent(a)}})}),a.define("module:Interactions.DropListStates.Idle",["module:Interactions.DropListStates.Disabled"],function(a,b){return a.extend({scoped:b},{_white_list:["Hover","Disabled"],_start:function(){this.on(this.element(),"drag-hover",function(a){var b=a.originalEvent.detail;this.parent().droppable(b)&&this.next("Hover")})}})}),a.define("module:Interactions.DropListStates.Hover",["module:Interactions.DropListStates.Disabled"],function(a,b){return a.extend({scoped:b},function(a){return{_white_list:["Idle","Disabled","Dropping"],_persistents:["drag_source"],_start:function(){this.trigger("hover"),this.on(this.element(),"drag-hover",function(a){this._drag_source=a.originalEvent.detail,this.parent().__update_floater(this._drag_source)}),this.on(this.element(),"drag-stop drag-leave",function(a){this._drag_source=a.originalEvent.detail,this.next("Idle")}),this.on(this.element(),"drag-drop",function(a){this._drag_source=a.originalEvent.detail,this.parent().__update_floater(this._drag_source),this.next("none"==this.parent()._floater.css("display")?"Idle":"Dropping")})},_end:function(){this.trigger("unhover"),this.parent()._floater.css("display","none"),a._end.call(this)}}})}),a.define("module:Interactions.DropListStates.Dropping",["module:Interactions.DropListStates.Disabled"],function(a,b){return a.extend({scoped:b},{_white_list:["Idle","Disabled"],_persistents:["drag_source"],_start:function(){this.trigger("dropped"),this._drag_source.source.dropped(this.parent()),this.next("Idle")}})}),a.define("module:Interactions.InfiniteScroll",["module:Interactions.Scroll","base:Objs"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(c,d,e){d=b.extend({append_count:25,prepend_count:25,height_factor:3,whitespace_bottom:!1,context:null,append:null,prepend:null},d),a.constructor.call(this,c,d),this._can_append=!!d.append,this._can_prepend=!!d.prepend,this._extending=!1,d.prepend&&this.options().whitespace&&(this.__top_white_space=this._whitespaceCreate(),this.itemsElement().prepend(this.__top_white_space)),this.options().whitespace_bottom&&(this.__bottom_white_space=this._whitespaceCreate(),this.itemsElement().append(this.__bottom_white_space)),this.reset(!0)},append:function(a){var b=this.options();if(this._can_append&&!this._extending){this._extending=!0;var c=this;b.append.call(b.context,a||b.append_count,function(a,b){c.__bottom_white_space&&c.itemsElement().append(c.__bottom_white_space),c._extending=!1,c._can_append=b,c.appended(a)})}},appendNeeded:function(){var a=this.element().get(0).scrollHeight,b=this.element().innerHeight(),c=a-(this.element().scrollTop()+b)-this._whitespaceGetHeight(this.__bottom_white_space);return c<this.options().height_factor*b},prependNeeded:function(){if(!this.options().prepend)return!1;var a=this.element().innerHeight(),b=this.element().scrollTop()-this._whitespaceGetHeight(this.__top_white_space);return b<this.options().height_factor*a},prepend:function(a){var b=this.options();if(this._can_prepend){this._extending=!0;var c=this;b.prepend(b.context,a||b.prepend_count,function(a,b){c.__top_white_space&&c.itemsElement().prepend(c.__top_white_space),c._extending=!1,c._can_prepend=b,c.prepended(a)})}},appended:function(a){},prepended:function(a){var b=this.itemsElement().find(":nth-child(2)"),c=this.itemsElement().find(":nth-child("+(1+a)+")"),d=c.offset().top-b.offset().top+c.outerHeight();this.scrolling()?this._whitespaceSetHeight(this.__top_white_space,this._whitespaceGetHeight(this.__top_white_space)-d):this.element().scrollTop(this.element().scrollTop()-d)},extendFix:function(){this.scrollingDirection()?this.appendNeeded()&&this.append():this.prependNeeded()&&this.prepend()},_whitespaceFix:function(){if(this.__top_white_space){var a=this._whitespaceGetHeight(this.__top_white_space);this._whitespaceSetHeight(this.__top_white_space,this.options().whitespace),this.element().scrollTop(this.element().scrollTop()+this.options().whitespace-a)}},reset:function(a){this._whitespaceSetHeight(this.__bottom_white_space,this.options().whitespace),this.options().prepend&&(this._whitespaceSetHeight(this.__top_white_space,this.options().whitespace),this.element().scrollTop(this.options().whitespace+(a?this.element().scrollTop():0)))}}})}),a.define("module:Interactions.InfiniteScrollStates.Idle",["module:Interactions.ScrollStates.Idle"],function(a,b){return a.extend({scoped:b},{})}),a.define("module:Interactions.InfiniteScrollStates.Scrolling",["module:Interactions.ScrollStates.Scrolling"],function(a,b){return a.extend({scoped:b},{_scroll:function(){this.parent().extendFix()},_scrollend:function(){this.parent()._whitespaceFix()}})}),a.define("module:Interactions.InfiniteScrollStates.ScrollingTo",["module:Interactions.ScrollStates.ScrollingTo"],function(a,b){return a.extend({scoped:b},{_scroll:function(){this.parent().extendFix()},_scrollend:function(){this.parent()._whitespaceFix()}})}),a.define("module:Interactions.ElementInteraction",["base:Class","base:Events.EventsMixin","module:Hardware.MouseCoords","jquery:","base:Async","base:States.Host","base:Ids","base:Objs"],function(a,b,c,d,e,f,g,h,i){return a.extend({scoped:i},[b,function(a){return{constructor:function(b,g){if(a.constructor.call(this),c.require(),this._element=d(d(b).get(0)),this._enabled=!1,this._options=g||{},"enabled"in this._options){var h=this._options.enabled;delete this._options.enabled,h&&e.eventually(this.enable,this)}this._host=new f,this._host.parent=this},__on:function(a,b,c,e){var f=this,i=b.split(" ");h.iter(i,function(b){d(a).on(b+"."+g.objectId(this),function(){c.apply(e||f,arguments)})},this)},destroy:function(){this.element().off("."+g.objectId(this)),this.disable(),this._host.destroy(),c.unrequire(),a.destroy.call(this)},enable:function(){this._enabled||(this._enabled=!0,this._enable())},disable:function(){this._enabled&&(this._enabled=!1,this._disable())},element:function(){return this._element},options:function(){return this._options},_enable:function(){},_disable:function(){}}}],{multiple:function(a,b,c,e){var f=this;d(a).each(function(){var a=new f(this,b);c&&c.call(e||a,a)})}})}),a.define("module:Interactions.State",["base:States.State","jquery:","base:Ids","base:Objs"],function(a,b,c,d,e){return a.extend({scoped:e},{parent:function(){return this.host.parent},element:function(){return this.parent().element()},options:function(){return this.parent().options()},on:function(a,e,f,g){var h=this,i=e.split(" ");d.iter(i,function(d){b(a).on(d+"."+c.objectId(this),function(){f.apply(g||h,arguments)})},this)},_end:function(){this.element().off("."+c.objectId(this)),b("body").off("."+c.objectId(this))}})}),a.define("module:Interactions.LoopScroll",["module:Interactions.Scroll"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c,d){a.constructor.call(this,b,c),this.__top_white_space=this._whitespaceCreate(),this.itemsElement().prepend(this.__top_white_space),this.__bottom_white_space=this._whitespaceCreate(),this.itemsElement().append(this.__bottom_white_space),this.reset(!0)},_rotateFix:function(){var a=this._whitespaceGetHeight(this.__top_white_space),b=this._whitespaceGetHeight(this.__bottom_white_space),c=this.element().get(0).scrollHeight,d=this.element().innerHeight(),e=c-a-b,f=this.element().scrollTop(),g=this.itemsElement().children().length-2,h=(f-a)/e*g,i=(e-(f-a)-d)/e*g;if(0>h)a=f-(e-d)/2,this._whitespaceSetHeight(this.__top_white_space,a);else if(0>i)a=f-(e-d)/2,this._whitespaceSetHeight(this.__top_white_space,a);else if(i-1>h)for(;i-1>h;){var j=this.itemsElement().find(":nth-last-child(2)");j.insertAfter(this.__top_white_space),a-=j.outerHeight(),this._whitespaceSetHeight(this.__top_white_space,a),i--,h++}else if(h-1>i)for(;h-1>i;){var k=this.itemsElement().find(":nth-child(2)");k.insertBefore(this.__bottom_white_space),a+=k.outerHeight(),this._whitespaceSetHeight(this.__top_white_space,a),i++,h--}},_whitespaceFix:function(){this._whitespaceSetHeight(this.__bottom_white_space,this.options().whitespace);var a=this._whitespaceGetHeight(this.__top_white_space);this._whitespaceSetHeight(this.__top_white_space,this.options().whitespace),this.element().scrollTop(this.element().scrollTop()+this.options().whitespace-a)},reset:function(a){this._whitespaceSetHeight(this.__bottom_white_space,this.options().whitespace),this._whitespaceSetHeight(this.__top_white_space,this.options().whitespace),this.element().scrollTop(this.options().whitespace+(a?this.element().scrollTop():0))}}})}),a.define("module:Interactions.LoopScrollStates.Idle",["module:Interactions.ScrollStates.Idle"],function(a,b){return a.extend({scoped:b},{})}),a.define("module:Interactions.LoopScrollStates.Scrolling",["module:Interactions.ScrollStates.Scrolling"],function(a,b){return a.extend({scoped:b},{_scroll:function(){this.parent()._rotateFix()},_scrollend:function(){this.parent()._whitespaceFix()}})}),a.define("module:Interactions.LoopScrollStates.ScrollingTo",["module:Interactions.ScrollStates.ScrollingTo"],function(a,b){return a.extend({scoped:b},{_scroll:function(){this.parent()._rotateFix()},_scrollend:function(){this.parent()._whitespaceFix()}})}),a.define("module:Interactions.Pinch",["module:Interactions.ElementInteraction"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c,d){a.constructor.call(this,b,c),this._host.initialize(this.cls.classname+"States.Idle"),this.data=d},_disable:function(){this.stop()},start:function(){this._enabled&&this._host.state().next("Pinching")},stop:function(){this._enabled&&this._host.state().next("Idle")},__eventData:function(){var a=this._host.state();return{element:this.element(),source:this,data:this.data,initial:a._initial_coords,delta_last:a._delta_last}},__triggerEvent:function(a){this.trigger(a,this.__eventData())}}})}),a.define("module:Interactions.PinchStates.Idle",["module:Interactions.State","module:Events.Mouse"],function(a,b,c){return a.extend({scoped:c},{_white_list:["Pinching"],trigger:function(a){this.parent().__triggerEvent(a)},_start:function(){this.on(this.element(),"touchstart",function(a){this.parent()._enabled&&a.originalEvent.touches&&2==a.originalEvent.touches.length&&this.next("Pinching",{initial_coords:b.clientCoords(a,!0)})})}})}),a.define("module:Interactions.PinchStates.Pinching",["module:Interactions.PinchStates.Idle","module:Events.Mouse"],function(a,b,c){return a.extend({scoped:c},function(a){return{_white_list:["Idle"],_persistents:["initial_coords","current_coords"],_initial_coords:null,_start:function(){this._last_coords=null,this._current_coords=this._initial_coords,this.trigger("pinchstart"),this.on(this.element(),"touchmove",function(a){return a.originalEvent.touches&&2==a.originalEvent.touches.length?void this.__pinching(a):void this.next("Idle")}),this.on(this.element(),"touchend",function(){this.next("Idle")})},_end:function(){this.trigger("pinchstop"),a._end.call(this)},__pinching:function(a){a.preventDefault(),this._last_coords=this._current_coords,this._current_coords=b.clientCoords(a,!0),this.__compute_values(),this.trigger("pinch")},__compute_values:function(){var a=function(a,b){return a[0][b]<=a[1][b]?a[0][b]:a[1][b]},b=function(a,b){return a[0][b]>=a[1][b]?a[0][b]:a[1][b]};this._delta_last={x:a(this._last_coords,"x")-a(this._current_coords,"x")+b(this._current_coords,"x")-b(this._last_coords,"x"),y:a(this._last_coords,"y")-a(this._current_coords,"y")+b(this._current_coords,"y")-b(this._last_coords,"y")}}}})}),a.define("module:Interactions.Scroll",["module:Interactions.ElementInteraction","base:Objs","jquery:","module:Elements.ElementSupport"],function(a,b,c,d,e){return a.extend({scoped:e},function(a){return{constructor:function(c,d,e){d=b.extend({discrete:!1,currentCenter:!1,currentTop:!0,scrollEndTimeout:50,whitespace:1e4,display_type:"",elementMargin:20},d),a.constructor.call(this,c,d),this._itemsElement=d.itemsElement||c,this._disableScrollCounter=0,this._host.initialize(this.cls.classname+"States.Idle"),this._scrollingDirection=!0,this._lastScrollTop=null,this.__on(this.element(),"scroll",function(){var a=this.element().scrollTop();null!==this._lastScrollTop&&(this._scrollingDirection=a>=this._lastScrollTop),this._lastScrollTop=a})},_whitespaceType:function(){return this.options().display_type?this.options().display_type:this.element().css("display").indexOf("flex")>=0?"flex":"default"},_whitespaceCreate:function(){var a=c("<whitespace></whitespace>"),b=this._whitespaceType();return"flex"==b?(a.css("display","-ms-flexbox"),a.css("display","-webkit-flex"),a.css("display","flex")):a.css("display","block"),a},_whitespaceGetHeight:function(a){return a?parseInt(a.css("height"),10):0},_whitespaceSetHeight:function(a,b){if(a){var c=this._whitespaceType();"flex"==c?(a.css("-webkit-flex","0 0 "+b+"px"),a.css("-ms-flex","0 0 "+b+"px"),a.css("flex","0 0 "+b+"px")):a.css("height",b+"px")}},itemsElement:function(){return this._itemsElement},scrollingDirection:function(){return this._scrollingDirection},currentElement:function(){for(var a=this.element().offset(),b=this._options.currentTop?this._options.elementMargin:this.element().innerHeight()-1-this._options.elementMargin,e=this.element().innerWidth()/2,f=c(d.elementFromPoint(a.left+e,a.top+b));f&&f.get(0)&&f.parent().get(0)!=this.itemsElement().get(0);)f=f.parent();if(!f||!f.get(0))return null;if(!this._options.currentCenter)return f;if(this._options.currentTop){var g=this.element().offset().top-f.offset().top;g>f.outerHeight()/2&&(f=f.next())}else{var h=this.element().offset().top+b-f.offset().top;h<f.outerHeight()/2&&(f=f.prev())}return f},scrollTo:function(a,b){var c=a-(this._options.currentTop?0:this.element().innerHeight()-1);b=b||{},b.scroll_top=c,this._host.state().next("ScrollingTo",b)},scrollToElement:function(a,b){var c=a.offset().top-this.element().offset().top+this.element().scrollTop();this.scrollTo(c+(this._options.currentTop?0:a.outerHeight()-1),b)},disableScroll:function(){0===this._disableScrollCounter&&this.element().css("overflow","hidden"),this._disableScrollCounter++},enableScroll:function(){this._disableScrollCounter--,0===this._disableScrollCounter&&this.element().css("overflow","scroll")},scrolling:function(){return"Idle"!=this._host.state().state_name();
}}})}),a.define("module:Interactions.ScrollStates.Idle",["module:Interactions.State"],function(a,b){return a.extend({scoped:b},{itemsElement:function(){return this.parent().itemsElement()},_start:function(){this.on(this.element(),"scroll",function(){this.next("Scrolling")})}})}),a.define("module:Interactions.ScrollStates.Scrolling",["module:Interactions.ScrollStates.Idle"],function(a,b){return a.extend({scoped:b},function(a){return{_start:function(){this.__timer=null,this.on(this.element(),"scroll",function(){this._scroll(),this.parent().trigger("scroll"),clearTimeout(this.__timer);var a=this.options(),b=this;this.__timer=setTimeout(function(){b.parent().disableScroll(),b.parent().trigger("scrollend"),b._scrollend();var c=b.parent().currentElement();a.discrete&&c?b.parent().scrollToElement(c,{animate:!0,abortable:!0}):b.eventualNext("Idle")},a.scrollEndTimeout)})},_scroll:function(){},_scrollend:function(){},_end:function(){clearTimeout(this.__timer),this.parent().enableScroll(),a._end.call(this)}}})}),a.define("module:Interactions.ScrollStates.ScrollingTo",["module:Interactions.ScrollStates.Idle","module:Elements.DefaultAnimator"],function(a,b,c){return a.extend({scoped:c},function(a){return{_locals:["scroll_top","animate","abortable"],_scroll_top:null,_abortable:null,_start:function(){this._abortable||this.parent().disableScroll(),this.parent().trigger("scrollto"),this.on(this.element(),"scroll",function(){this._scroll()}),this._abortable&&(this.on(this.element(),"wheel",function(){this._moved=!0,this._abort()}),this.on(this.element(),"touchstart",function(){this._moved=!0,this._abort()})),this.suspend(),this._animate?(this._animation=new b(this.element(),{styles:{scrollTop:this._scroll_top}},this._finished,this),this._animation.start()):(this.element().scrollTop(this._scroll_top),this._finished())},_abort:function(){this._aborted||(this._aborted=!0,this._animate?(this._animation&&this._animation.complete(),this._animation=null):this._finished())},_finished:function(){this.parent().trigger("scrolltoend"),this._scrollend(),this._transitioning?this.eventualResume():(this.resume(),this.eventualNext(this._moved?"Scrolling":"Idle"))},_scroll:function(){},_scrollend:function(){},_transition:function(){this._abort()},_end:function(){this._abortable||this.parent().enableScroll(),a._end.call(this)}}})}),a.define("module:Gestures.ElementStateHost",["base:States.CompetingHost"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c){a.constructor.call(this,c),this._element=b},element:function(){return this._element}}})}),a.define("module:Gestures.Gesture",["module:Gestures.ElementStateHost","module:Hardware.MouseCoords","base:States.CompetingComposite","base:Objs"],function(a,b,c,d,e){return a.extend({scoped:e},function(a){return{constructor:function(e,f){var g=e.data("gestures");g||(g=new c,e.data("gestures",g)),a.constructor.call(this,e,g),b.require();for(var h in f)f[h]=d.extend({priority:1,exclusive:!1,retreat:"Retreat"},f[h]);this.initialize(this.cls.classname+"States.EventDrivenState",{state_descriptor:f,current_state:"Initial"})},destroy:function(){b.unrequire(),a.destroy.call(this)}}})}),a.define("module:Gestures.ElementState",["base:States.CompetingState","base:Ids","base:Objs"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{_persistents:["client_pos","screen_pos"],_start:function(){a._start.call(this),this.on("mousemove touchmove",function(a){var b="mousemove"==a.type?a.originalEvent:a.originalEvent.touches[0];this._client_pos={x:b.clientX,y:b.clientY},this._screen_pos={x:b.screenX,y:b.screenY}})},element:function(){return this.host.element()},on:function(a,d){var e=this,f=a.split(" ");c.iter(f,function(a){this.element().on(a+"."+b.objectId(this),function(a){d.call(e,a)})},this)},_end:function(){this.element().off("."+b.objectId(this))},trigger:function(){this.host.trigger.apply(this.host,arguments)}}})}),a.define("module:Gestures.ElementEvent",["base:Class","base:Ids","base:Objs","jquery:"],function(a,b,c,d,e){return a.extend({scoped:e},function(a){return{constructor:function(b,c,d){a.constructor.call(this),this._element=b,this._callback=c,this._context=d},callback:function(){this._callback&&this._callback.apply(this._context,arguments)},on:function(a,d,e,f){var g=this,h=a.split(" ");f=f||this._element,c.iter(h,function(a){f.on(a+"."+b.objectId(this),function(a){d.call(e||g,a)})},this)},destroy:function(){this._element.off("."+b.objectId(this)),d("body").off("."+b.objectId(this)),a.destroy.call(this)}}})}),a.define("module:Gestures.ElementTriggerEvent",["module:Gestures.ElementEvent"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c,d,e){a.constructor.call(this,c,d,e),this.on(b,function(){this.callback()})}}})}),a.define("module:Gestures.BodyTriggerEvent",["module:Gestures.ElementEvent","jquery:"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(c,d,e,f){a.constructor.call(this,d,e,f),this.on(c,function(){this.callback()},this,b("body"))}}})}),a.define("module:Gestures.ElementTimerEvent",["module:Gestures.ElementEvent"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c,d,e){a.constructor.call(this,c,d,e);var f=this;0>=b||(this._timer=setTimeout(function(){f.callback()},b))},destroy:function(){clearTimeout(this._timer),a.destroy.call(this)}}})}),a.define("module:Gestures.ElementMouseMoveOutEvent",["module:Gestures.ElementEvent","module:Hardware.MouseCoords","module:Events.Mouse"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{constructor:function(d,e,f,g){a.constructor.call(this,e,f,g);var h=b.coords,i={x:0,y:0};this.on(c.moveEvent,function(a){h.x||h.y||(h=c.pageCoords(a));var b=c.pageCoords(a);i.x=Math.max(i.x,Math.abs(h.x-b.x)),i.y=Math.max(i.y,Math.abs(h.y-b.y)),("x"in d&&d.x>=0&&i.x>=d.x||"y"in d&&d.y>=0&&i.y>=d.y)&&this.callback()})}}})}),a.define("module:Gestures.GestureStates.EventDrivenState",["module:Gestures.ElementState","module:Gestures"],function(a,b,c){return a.extend({scoped:c},function(a){return{_persistents:["client_pos","screen_pos","state_descriptor"],_locals:["current_state"],_state_descriptor:null,_current_state:null,current_state:function(){return this._state_descriptor[this._current_state]},description:function(){return this._current_state},nextDrivenState:function(a){this.next("EventDrivenState",{current_state:a})},_start:function(){a._start.call(this);var c=this.current_state();c.start&&c.start.apply(this),c.events=c.events||[];for(var d=function(a){this._auto_destroy(new b[a.event](a.args,this.element(),function(){this.nextDrivenState(a.target)},this))},e=0;e<c.events.length;++e)d.call(this,c.events[e])},_end:function(){var b=this.current_state();b.end&&b.end.apply(this),a._end.call(this)},can_coexist_with:function(a){return!this.current_state().exclusive&&!a.current_state().exclusive},can_prevail_against:function(a){return this.current_state().priority>a.current_state().priority},retreat_against:function(a){this.nextDrivenState(this.current_state().retreat)}}})}),a.define("module:Gestures.defaultGesture",["base:Objs","module:Events.Mouse"],function(a,b){return function(c){return c=a.extend({mouse_up_activate:!1,wait_time:750,wait_activate:!0,disable_x:10,disable_y:10,enable_x:-1,enable_y:-1,active_priority:2},c),{Initial:{events:[{event:"ElementTriggerEvent",args:b.downEvent,target:"DownState"}]},Retreat:{start:function(){this.trigger("deactivate"),this.nextDrivenState("Initial")}},DownState:{events:[{event:"BodyTriggerEvent",args:b.upEvent,target:c.mouse_up_activate?"ActiveState":"Initial"},{event:"ElementMouseMoveOutEvent",args:{x:c.disable_x,y:c.disable_y},target:"Initial"},{event:"ElementMouseMoveOutEvent",args:{x:c.enable_x,y:c.enable_y},target:"ActiveState"},{event:"ElementTimerEvent",args:c.wait_time,target:c.wait_activate?"ActiveState":"Initial"}]},ActiveState:{priority:c.active_priority,exclusive:!0,start:function(){this.trigger("activate"),this.nextDrivenState("Initial")}}}}}),a.define("module:Dynamics.GesturePartial",["dynamics:Handlers.Partial","module:Gestures.Gesture","module:Gestures","base:Objs"],function(a,b,c,d,e){var f=a.extend({scoped:e},{_apply:function(a){var e=this._node,f=e._handler;if(e.gestures=f.node||{},!(this._postfix in e.gestures)||e.gestures[this._postfix].destroyed()){a=d.extend(a,a.options);var g=new b(this._node._$element,c.defaultGesture(a));e.gestures[this._postfix]=g,g.on("activate",function(){a.activate_event&&f.call(a.activate_event,a.data,this._node,g),a.interaction&&e.interactions&&e.interactions[a.interaction]&&e.interactions[a.interaction].start&&e.interactions[a.interaction].start()},this),g.on("deactivate",function(){a.deactivate_event&&f.call(a.deactivate_event,a.data,this._node,g),a.interaction&&e.interactions&&e.interactions[a.interaction]&&e.interactions[a.interaction].stop&&e.interactions[a.interaction].stop()},this)}},_deactivate:function(){var a=this._node;a.gestures=a.gestures||{},this._postfix in a.gestures&&a.gestures[this._postfix].weakDestroy()}});return f.register("ba-gesture"),f}),a.define("module:Dynamics.InteractionPartial",["dynamics:Handlers.Partial","module:Interactions","base:Strings","base:Objs","base:Types"],function(a,b,c,d,e,f){var g=a.extend({scoped:f},{_apply:function(a){var f=this._node,g=f._handler;if(f.interactions=f.interactions||{},!(this._postfix in f.interactions)||f.interactions[this._postfix].destroyed()){a=d.extend(a,a.options);var h=b[c.capitalize(a.type)],i=new h(a.sub?this._node._$element.find(a.sub):this._node._$element,d.extend({enabled:!0},a));f.interactions[this._postfix]=i,d.iter(a.events,function(b,c){i.on(c,function(c,d,f,h){e.is_string(b)?g.call(b,a.data,c,d,f,h):b.call(g,a.data,c,d,f,h)},this)},this)}},_deactivate:function(){var a=this._node;a.interactions=a.interactions||{},this._postfix in a.interactions&&a.interactions[this._postfix].weakDestroy()}});return g.register("ba-interaction"),g})}).call(Scoped);
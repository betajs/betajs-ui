BetaJS.Class.extend("BetaJS.UI.Elements.Animators",{constructor:function(a,b,c,d){this._inherited(BetaJS.UI.Elements.Animators,"constructor"),this._element=a,this._options=BetaJS.Objs.extend({callback_on_revert:!0,callback_on_complete:!0,auto_start:!0,auto_destroy:!0},b),this._callback=c,this._context=d,this._running=!1,this._options.auto_start&&this.start()},start:function(){this._running||(this._running=!0,this._start())},revert:function(){this._running&&(this._running=!1,this._revert())},complete:function(){this._running&&this._complete()},__callback:function(){this._callback.apply(this._context||this),this._options&&this._options.auto_destroy&&this.destroy()},_finished:function(){this.__callback()},_reverted:function(){this._options.callback_on_revert&&this.__callback()},_completed:function(){this._options.callback_on_complete&&this.__callback()},_start:function(){this._finished()},_revert:function(){this._reverted()},_complete:function(){this._completed()}}),BetaJS.UI.Elements.Animators.extend("BetaJS.UI.Elements.DefaultAnimator",{constructor:function(a,b,c,d){b=BetaJS.Objs.extend({duration:250,styles:{},method:"swing"},b),this._inherited(BetaJS.UI.Elements.DefaultAnimator,"constructor",a,b,c,d)},_start:function(){var a=this;this.__animate=this._element.animate(this._options.styles,this._options.duration,this._options.method,function(){a._finished()})},_revert:function(){this.__animate.stop(),this._reverted()},_complete:function(){this.__animate.stop(!0),this._completed()}}),BetaJS.Class.extend("BetaJS.UI.Elements.ElementModifier",{constructor:function(a){this._inherited(BetaJS.UI.Elements.ElementModifier,"constructor"),this._element=BetaJS.$(a),this._css={},this._cls={}},css:function(a,b){return arguments.length<2?this._element.css.apply(this._element,arguments):this._element.css(a)===b?b:(a in this._css||(this._css[a]=this._element.css(a)),this._element.css(a,b),b)},csscls:function(a,b){var c=this._element.hasClass(a);return arguments.length<2?a:c===b?b:(a in this._cls||(this._cls[a]=c),b?this._element.addClass(a):this._element.removeClass(a),b)},removeClass:function(a){this._element.hasClass(a)&&(a in this._cls||(this._cls[a]=!0),this._element.addClass(a))},revert:function(){for(var a in this._css)this._element.css(a,this._css[a]);for(a in this._cls)this._cls[a]?this._element.addClass(a):this._element.removeClass(a)}}),BetaJS.UI.Elements.Support={elementFromPoint:function(a,b,c){c=c||[],BetaJS.Types.is_array(c)||(c=[c]);for(var d=[],e=0;e<c.length;++e)c[e]=BetaJS.$(c[e]),d.push(c[e].css("z-index")),c[e].css("z-index",-1);var f=document.elementFromPoint(a-window.pageXOffset,b-window.pageYOffset);for(e=0;e<c.length;++e)c[e].css("z-index",d[e]);return f},elementBoundingBox:function(a){a=BetaJS.$(a);var b=a.offset();return{left:b.left,top:b.top,right:b.left+a.outerWidth()-1,bottom:b.top+a.outerHeight()-1}},pointWithinElement:function(a,b,c){var d=this.elementBoundingBox(c);return d.left<=a&&a<=d.right&&d.top<=b&&b<=d.bottom},childContainingElement:function(a,b){for(a=BetaJS.$(a).get(0),b=BetaJS.$(b).get(0);b.parentNode!=a;){if(b==document.body)return null;b=b.parentNode}return b}},BetaJS.UI.Events={},BetaJS.UI.Events.Support={dispatchElementEvent:function(a,b,c,d){a.dispatchEvent(new CustomEvent(b,BetaJS.Objs.extend({bubbles:!0,cancelable:!0,detail:c},d)))},dispatchElementsEvent:function(a,b,c,d){for(var e=0;e<a.length;++e)a[e].dispatchEvent(new CustomEvent(b,BetaJS.Objs.extend({bubbles:!1,cancelable:!0,detail:c},d)))},dispatchManualBubbleEvent:function(a,b,c,d,e){this.dispatchElementsEvent(BetaJS.$(a).parents().andSelf().filter(c),b,d,e)},dispatchPointsSeparatorEvent:function(a,b,c,d,e,f){c=c?BetaJS.Types.is_array(c)?c:[c]:[],d=d?BetaJS.Types.is_array(d)?d:[d]:[],this.dispatchManualBubbleEvent(a,b,function(){for(var a=0;a<c.length;++a)if(!BetaJS.UI.Elements.Support.pointWithinElement(c[a].x,c[a].y,this))return!1;for(a=0;a<d.length;++a)if(BetaJS.UI.Elements.Support.pointWithinElement(d[a].x,d[a].y,this))return!1;return!0},e,f)}},BetaJS.UI.Events.Mouse={downEvent:BetaJS.Browser.Info.isMobile()?"touchstart":"mousedown",moveEvent:BetaJS.Browser.Info.isMobile()?"touchmove":"mousemove",upEvent:BetaJS.Browser.Info.isMobile()?"touchend":"mouseup",pageCoords:function(a){return a.originalEvent.touches?{x:a.originalEvent.touches[0].pageX,y:a.originalEvent.touches[0].pageY}:{x:a.pageX,y:a.pageY}}},BetaJS.Class.extend("BetaJS.UI.Interactions.ElementInteraction",[BetaJS.Events.EventsMixin,{constructor:function(a,b){if(this._inherited(BetaJS.UI.Interactions.ElementInteraction,"constructor"),this._element=BetaJS.$(BetaJS.$(a).get(0)),this._enabled=!1,this._options=b||{},"enabled"in this._options){var c=this._options.enabled;delete this._options.enabled,c&&BetaJS.SyncAsync.eventually(this.enable,this)}this._host=new BetaJS.States.Host,this._host.parent=this},destroy:function(){this.disable(),this._host.destroy(),this._inherited(BetaJS.UI.Interactions.ElementInteraction,"destroy")},enable:function(){this._enabled||(this._enabled=!0,this._enable())},disable:function(){this._enabled&&(this._enabled=!1,this._disable())},element:function(){return this._element},options:function(){return this._options},_enable:function(){},_disable:function(){}}],{multiple:function(a,b,c,d){var e=this;BetaJS.$(a).each(function(){var a=new e(this,b);c&&c.call(d||a,a)})}}),BetaJS.States.State.extend("BetaJS.UI.Interactions.State",{parent:function(){return this.host.parent},element:function(){return this.parent().element()},options:function(){return this.parent().options()},on:function(a,b,c,d){for(var e=this,f=b.split(" "),g=0;g<f.length;++g)BetaJS.$(a).on(f[g]+"."+BetaJS.Ids.objectId(this),function(){c.apply(d||e,arguments)})},_end:function(){this.element().off("."+BetaJS.Ids.objectId(this)),BetaJS.$("body").off("."+BetaJS.Ids.objectId(this))}}),BetaJS.UI.Interactions.ElementInteraction.extend("BetaJS.UI.Interactions.Drag",{constructor:function(a,b,c){b=BetaJS.Objs.extend({start_event:BetaJS.UI.Events.Mouse.downEvent,stop_event:BetaJS.UI.Events.Mouse.upEvent,draggable_x:!0,draggable_y:!0,clone_element:!1,droppable:!1,remove_element_on_drop:!1,revertable:!0},b),this._inherited(BetaJS.UI.Interactions.Drag,"constructor",a,b),this._host.initialize("BetaJS.UI.Interactions.Drag.Idle"),this._modifier=new BetaJS.UI.Elements.ElementModifier(this._element),this.data=c},destroy:function(){this._modifier.revert(),this._modifier.destroy(),this._inherited(BetaJS.UI.Interactions.Drag,"destroy")},_enable:function(){this._options.start_event&&this._element.on(this._options.start_event+"."+BetaJS.Ids.objectId(this),BetaJS.Functions.as_method(this.start,this))},_disable:function(){this._element.off("."+BetaJS.Ids.objectId(this)),this.stop()},start:function(){this._enabled&&this._host.state().next("Starting")},stop:function(){this._enabled&&this._host.state().next("Stopping")},abort:function(){this._enabled&&this._host.state().next("Idle")},dropped:function(a){this.trigger("dropped",a),this._host.state().next("Stopping",{immediately:!0}),this._options.remove_element_on_drop&&(this.element().remove(),this.destroy())},actionable_element:function(){var a=this._host.state()._cloned_element;return a?a:this._element},modifier:function(){return this._modifier},actionable_modifier:function(){var a=this._host.state()._cloned_modifier;return a?a:this._modifier},__eventData:function(){return{element:this.element(),actionable_element:this.actionable_element(),modifier:this.modifier(),actionable_modifier:this.actionable_modifier(),source:this,data:this.data,page_coords:this._host.state()._page_coords,underneath:this.__underneath}},__triggerEvent:function(a){this.trigger(a,this.__eventData())},__triggerDomEvent:function(a){var b=this.__eventData();if(b.page_coords){var c=BetaJS.UI.Elements.Support.elementFromPoint(b.page_coords.x,b.page_coords.y,this.actionable_element());c&&BetaJS.UI.Events.Support.dispatchElementEvent(c,"drag-"+a,b)}},__triggerDomMove:function(){var a=this.__eventData();if(a.page_coords){var b=BetaJS.UI.Elements.Support.elementFromPoint(a.page_coords.x,a.page_coords.y,this.actionable_element());b&&(this.__old_coords&&this.__underneath&&this.__underneath!=b&&(BetaJS.UI.Events.Support.dispatchPointsSeparatorEvent(b,"drag-enter",a.page_coords,this.__old_coords,a),BetaJS.UI.Events.Support.dispatchPointsSeparatorEvent(this.__underneath,"drag-leave",this.__old_coords,a.page_coords,a)),BetaJS.UI.Events.Support.dispatchElementEvent(b,"drag-hover",a)),this.__underneath=b,this.__old_coords=a.page_coords}}}),BetaJS.UI.Interactions.State.extend("BetaJS.UI.Interactions.Drag.Idle",{_white_list:["Starting"],trigger:function(a){this.parent().__triggerEvent(a)},triggerDom:function(a){this.parent().__triggerDomEvent(a)},triggerDomMove:function(){this.parent().__triggerDomMove()}}),BetaJS.UI.Interactions.Drag.Idle.extend("BetaJS.UI.Interactions.Drag.Starting",{_white_list:["Stopping","Dragging"],_persistents:["initial_element_coords","cloned_element","cloned_modifier"],_start:function(){this.on("body",BetaJS.UI.Events.Mouse.moveEvent,function(a){this.next("Dragging",{page_coords:BetaJS.UI.Events.Mouse.pageCoords(a)})});var a=this.parent().options();if(a.stop_event&&this.on("body",a.stop_event,function(){this.next("Stopping")}),a.clone_element)this._cloned_element=this.element().clone(),this._cloned_element.css("position","absolute"),this._cloned_element.css("width",this.element().width()),this._cloned_element.css("height",this.element().height()),this._cloned_element.css("z-index",this.element().css("z-index")+1),this._initial_element_coords={x:this.element().offset().left,y:this.element().offset().top},this._cloned_element.css("left",this._initial_element_coords.x+"px"),this._cloned_element.css("top",this._initial_element_coords.y+"px"),BetaJS.$("body").append(this._cloned_element),this._cloned_modifier=new BetaJS.UI.Elements.ElementModifier(this._cloned_element);else{var b=this.parent().modifier();if(b.css("position","relative"),this._initial_element_coords={},a.draggable_x){var c=b.css("left");"auto"!==c&&c||b.css("left","0px"),this._initial_element_coords.x=parseInt(b.css("left"),10)}if(a.draggable_y){var d=b.css("top");"auto"!==d&&c||b.css("top","0px"),this._initial_element_coords.y=parseInt(b.css("top"),10)}}this.trigger("start")}}),BetaJS.UI.Interactions.Drag.Idle.extend("BetaJS.UI.Interactions.Drag.Dragging",{_white_list:["Stopping"],_persistents:["page_coords","initial_element_coords","cloned_element","cloned_modifier"],_start:function(){this.on("body",BetaJS.UI.Events.Mouse.moveEvent,this.__dragging);var a=this.parent()._options;a.stop_event&&this.on("body",a.stop_event,function(){a.droppable&&this.triggerDom("drop"),"next"in this&&this.next("Stopping",{released:!0})})},__dragging:function(a){var b=BetaJS.UI.Events.Mouse.pageCoords(a),c={x:b.x-this._page_coords.x,y:b.y-this._page_coords.y};this._page_coords=b;var d=this.parent().actionable_modifier();this.options().draggable_x&&d.css("left",parseInt(d.css("left"),10)+c.x+"px"),this.options().draggable_y&&d.css("top",parseInt(d.css("top"),10)+c.y+"px"),this.trigger("move"),this.triggerDomMove()}}),BetaJS.UI.Interactions.Drag.Idle.extend("BetaJS.UI.Interactions.Drag.Stopping",{_white_list:["Idle","Starting"],_locals:["page_coords","initial_element_coords","cloned_element","cloned_modifier","immediately","released"],_start:function(){this.trigger("stopping"),this.triggerDom("stop");var a=this.options();if(!a.revertable||this._immediately)return this._released&&this.trigger("release"),void this.next("Idle");var b={};a.draggable_x&&(b.left=this._initial_element_coords.x+"px"),a.draggable_y&&(b.top=this._initial_element_coords.y+"px"),this.__animation=new BetaJS.UI.Elements.DefaultAnimator(this.parent().actionable_element(),{styles:b},function(){this.__animation&&this.next("Idle")},this),this._released&&this.trigger("release")},_end:function(){if(this.__animation){var a=this.__animation;this.__animation=null,a.complete()}this._cloned_modifier&&this._cloned_modifier.destroy(),this._cloned_element&&this._cloned_element.remove(),this.parent().modifier().revert(),this.trigger("stop"),this._inherited(BetaJS.UI.Interactions.Drag.Stopping,"_end")}}),BetaJS.UI.Interactions.ElementInteraction.extend("BetaJS.UI.Interactions.Drop",{constructor:function(a,b,c){b=BetaJS.Objs.extend({droppable:function(){return!0},context:this,bounding_box:function(a){return a}},b),this._inherited(BetaJS.UI.Interactions.Drop,"constructor",a,b),this._host.initialize("BetaJS.UI.Interactions.Drop.Idle"),this._modifier=new BetaJS.UI.Elements.ElementModifier(this._element),this.data=c},destroy:function(){this._modifier.revert(),this._modifier.destroy(),this._host.destroy(),this._inherited(BetaJS.UI.Interactions.Drop,"destroy")},_enable:function(){this._host.state().next("Idle")},_disable:function(){this._host.state().next("Disabled")},modifier:function(){return this._modifier},__eventData:function(){return{element:this.element(),modifier:this.modifier(),target:this,data:this.data,source:this._host.state()._drag_source?this._host.state()._drag_source:null}},__triggerEvent:function(a){this.trigger(a,this.__eventData())},droppable:function(a){return this._options.droppable.call(this._options.context,a,this)},_is_hovering:function(a){var b=BetaJS.UI.Elements.Support.elementBoundingBox(this.element());b=this._options.bounding_box.call(this._options.context,b);var c=a.page_coords;return b.left<=c.x&&c.x<=b.right&&b.top<=c.y&&c.y<=b.bottom}}),BetaJS.UI.Interactions.State.extend("BetaJS.UI.Interactions.Drop.Disabled",{_white_list:["Idle"],trigger:function(a){this.parent().__triggerEvent(a)}}),BetaJS.UI.Interactions.Drop.Disabled.extend("BetaJS.UI.Interactions.Drop.Idle",{_white_list:["Hover","InvalidHover","Disabled"],_start:function(){this.on(this.element(),"drag-hover",function(a){var b=a.originalEvent.detail;this.parent()._is_hovering(b)&&this.next(this.parent().droppable(b)?"Hover":"InvalidHover",{drag_source:b})})}}),BetaJS.UI.Interactions.Drop.Disabled.extend("BetaJS.UI.Interactions.Drop.Hover",{_white_list:["Idle","Disabled","Dropping"],_persistents:["drag_source"],_start:function(){this.trigger("hover"),this.on(this.element(),"drag-hover",function(a){this._drag_source=a.originalEvent.detail,this.parent()._is_hovering(this._drag_source)||this.next("Idle")}),this.on(this.element(),"drag-stop drag-leave",function(a){this._drag_source=a.originalEvent.detail,this.next("Idle")}),this.on(this.element(),"drag-drop",function(a){this._drag_source=a.originalEvent.detail,this.next("Dropping")})},_end:function(){this.trigger("unhover"),this.parent().modifier().revert(),this._inherited(BetaJS.UI.Interactions.Drop.Hover,"_end")}}),BetaJS.UI.Interactions.Drop.Disabled.extend("BetaJS.UI.Interactions.Drop.InvalidHover",{_white_list:["Idle","Disabled"],_persistents:["drag_source"],_start:function(){this.trigger("hover-invalid"),this.on(this.element(),"drag-hover",function(a){this._drag_source=a.originalEvent.detail,this.parent()._is_hovering(this._drag_source)||this.next("Idle")}),this.on(this.element(),"drag-drop drag-stop drag-leave",function(a){this._drag_source=a.originalEvent.detail,this.next("Idle")})},_end:function(){this.trigger("unhover"),this.parent().modifier().revert(),this._inherited(BetaJS.UI.Interactions.Drop.InvalidHover,"_end")}}),BetaJS.UI.Interactions.Drop.Disabled.extend("BetaJS.UI.Interactions.Drop.Dropping",{_white_list:["Idle","Disabled"],_persistents:["drag_source"],_start:function(){this.trigger("dropped"),this._drag_source.source.dropped(this.parent()),this.next("Idle")}}),BetaJS.UI.Interactions.ElementInteraction.extend("BetaJS.UI.Interactions.DropList",{constructor:function(a,b,c){b=BetaJS.Objs.extend({droppable:function(){return!0},context:this,bounding_box:function(a){return a},floater:null},b),this._inherited(BetaJS.UI.Interactions.DropList,"constructor",a,b),this._host.initialize("BetaJS.UI.Interactions.DropList.Idle"),this.data=c,this._floater=BetaJS.$(this._options.floater),this._floater.css("display","none")},destroy:function(){this._host.destroy(),this._inherited(BetaJS.UI.Interactions.DropList,"destroy")},_enable:function(){this._host.state().next("Idle")},_disable:function(){this._host.state().next("Disabled")},__eventData:function(){return{index:this._floater.index(),element:this.element(),target:this,data:this.data,source:this._host.state()._drag_source?this._host.state()._drag_source:null}},__triggerEvent:function(a){this.trigger(a,this.__eventData())},droppable:function(a){return this._options.droppable.call(this._options.context,a,this)},__update_floater:function(a){this._floater.css("display","none");var b=a.page_coords,c=BetaJS.UI.Elements.Support.childContainingElement(this.element(),a.underneath);if(c){if(c=BetaJS.$(c),c.get(0)==this._floater.get(0))return void this._floater.css("display","");var d=BetaJS.UI.Elements.Support.elementBoundingBox(c);d=this._options.bounding_box.call(this._options.context,d),d.top<=b.y&&b.y<=d.bottom||(this._floater.css("display",""),b.y<d.top?this._floater.insertBefore(c):this._floater.insertAfter(c))}},insertAt:function(a,b){var c=this.element().children().size();0>b&&(b=Math.max(0,c+1+b)),this.element().append(a),c>b&&this.element().children().eq(b).before(this.element().children().last())}}),BetaJS.UI.Interactions.State.extend("BetaJS.UI.Interactions.DropList.Disabled",{_white_list:["Idle"],trigger:function(a){this.parent().__triggerEvent(a)}}),BetaJS.UI.Interactions.DropList.Disabled.extend("BetaJS.UI.Interactions.DropList.Idle",{_white_list:["Hover","Disabled"],_start:function(){this.on(this.element(),"drag-hover",function(a){var b=a.originalEvent.detail;this.parent().droppable(b)&&this.next("Hover")})}}),BetaJS.UI.Interactions.DropList.Disabled.extend("BetaJS.UI.Interactions.DropList.Hover",{_white_list:["Idle","Disabled","Dropping"],_persistents:["drag_source"],_start:function(){this.trigger("hover"),this.on(this.element(),"drag-hover",function(a){this._drag_source=a.originalEvent.detail,this.parent().__update_floater(this._drag_source)}),this.on(this.element(),"drag-stop drag-leave",function(a){this._drag_source=a.originalEvent.detail,this.next("Idle")}),this.on(this.element(),"drag-drop",function(a){this._drag_source=a.originalEvent.detail,this.parent().__update_floater(this._drag_source),this.next("none"==this.parent()._floater.css("display")?"Idle":"Dropping")})},_end:function(){this.trigger("unhover"),this.parent()._floater.css("display","none"),this._inherited(BetaJS.UI.Interactions.DropList.Hover,"_end")}}),BetaJS.UI.Interactions.DropList.Disabled.extend("BetaJS.UI.Interactions.DropList.Dropping",{_white_list:["Idle","Disabled"],_persistents:["drag_source"],_start:function(){this.trigger("dropped"),this._drag_source.source.dropped(this.parent()),this.next("Idle")}}),BetaJS.States.CompetingHost.extend("BetaJS.UI.Gestures.ElementStateHost",{constructor:function(a,b){this._inherited(BetaJS.UI.Gestures.ElementStateHost,"constructor",b),this._element=a},element:function(){return this._element}}),BetaJS.UI.Gestures.ElementStateHost.extend("BetaJS.UI.Gestures.Gesture",{constructor:function(a,b){var c=a.data("gestures");c||(c=new BetaJS.States.CompetingComposite,a.data("gestures",c)),this._inherited(BetaJS.UI.Gestures.Gesture,"constructor",a,c);for(var d in b)b[d]=BetaJS.Objs.extend({priority:1,exclusive:!1,retreat:"Retreat"},b[d]);this.initialize("BetaJS.UI.Gestures.EventDrivenState",{state_descriptor:b,current_state:"Initial"})}}),BetaJS.States.CompetingState.extend("BetaJS.UI.Gestures.ElementState",{_persistents:["client_pos","screen_pos"],_start:function(){this._inherited(BetaJS.UI.Gestures.ElementState,"_start"),this.on("mousemove touchmove",function(a){var b="mousemove"==a.type?a.originalEvent:a.originalEvent.touches[0];this._client_pos={x:b.clientX,y:b.clientY},this._screen_pos={x:b.screenX,y:b.screenY}})},element:function(){return this.host.element()},on:function(a,b){for(var c=this,d=a.split(" "),e=0;e<d.length;++e)this.element().on(d[e]+"."+BetaJS.Ids.objectId(this),function(a){b.call(c,a)})},_end:function(){this.element().off("."+BetaJS.Ids.objectId(this))},trigger:function(){this.host.trigger.apply(this.host,arguments)}}),BetaJS.Class.extend("BetaJS.UI.Gestures.ElementEvent",{constructor:function(a,b,c){this._inherited(BetaJS.UI.Gestures.ElementEvent,"constructor"),this._element=a,this._callback=b,this._context=c},callback:function(){this._callback&&this._callback.apply(this._context,arguments)},on:function(a,b,c,d){var e=this,f=a.split(" ");d=d||this._element;for(var g=0;g<f.length;++g)d.on(f[g]+"."+BetaJS.Ids.objectId(this),function(a){b.call(c||e,a)})},destroy:function(){this._element.off("."+BetaJS.Ids.objectId(this)),BetaJS.$("body").off("."+BetaJS.Ids.objectId(this)),this._inherited(BetaJS.UI.Gestures.ElementEvent,"destroy")}}),BetaJS.UI.Gestures.ElementEvent.extend("BetaJS.UI.Gestures.ElementTriggerEvent",{constructor:function(a,b,c,d){this._inherited(BetaJS.UI.Gestures.ElementTriggerEvent,"constructor",b,c,d),this.on(a,function(){this.callback()})}}),BetaJS.UI.Gestures.ElementEvent.extend("BetaJS.UI.Gestures.BodyTriggerEvent",{constructor:function(a,b,c,d){this._inherited(BetaJS.UI.Gestures.ElementTriggerEvent,"constructor",b,c,d),this.on(a,function(){this.callback()},this,BetaJS.$("body"))}}),BetaJS.UI.Gestures.ElementEvent.extend("BetaJS.UI.Gestures.ElementTimerEvent",{constructor:function(a,b,c,d){this._inherited(BetaJS.UI.Gestures.ElementTimerEvent,"constructor",b,c,d);var e=this;0>=a||(this._timer=setTimeout(function(){e.callback()},a))},destroy:function(){clearTimeout(this._timer),this._inherited(BetaJS.UI.Gestures.ElementTimerEvent,"destroy")}}),BetaJS.UI.Gestures.ElementEvent.extend("BetaJS.UI.Gestures.ElementMouseMoveOutEvent",{constructor:function(a,b,c,d){this._inherited(BetaJS.UI.Gestures.ElementMouseMoveOutEvent,"constructor",b,c,d);var e=null,f=[0,0];this.on("mousemove touchmove",function(b){var c="mousemove"==b.type?b.originalEvent:b.originalEvent.touches[0],d=[c.clientX,c.clientY];e||(e=d),f[0]=Math.max(f[0],Math.abs(e[0]-d[0])),f[1]=Math.max(f[1],Math.abs(e[1]-d[1])),("x"in a&&a.x>=0&&f[0]>=a.x||"y"in a&&a.y>=0&&f[1]>=a.y)&&this.callback()})}}),BetaJS.UI.Gestures.ElementState.extend("BetaJS.UI.Gestures.EventDrivenState",{_persistents:["client_pos","screen_pos","state_descriptor"],_locals:["current_state"],current_state:function(){return this._state_descriptor[this._current_state]},description:function(){return this._current_state},nextDrivenState:function(a){this.next("EventDrivenState",{current_state:a})},_start:function(){function a(a){this._auto_destroy(new BetaJS.UI.Gestures[a.event](a.args,this.element(),function(){this.nextDrivenState(a.target)},this))}this._inherited(BetaJS.UI.Gestures.EventDrivenState,"_start");var b=this.current_state();b.start&&b.start.apply(this),b.events=b.events||[];for(var c=0;c<b.events.length;++c)a.call(this,b.events[c])},_end:function(){var a=this.current_state();a.end&&a.end.apply(this),this._inherited(BetaJS.UI.Gestures.EventDrivenState,"_end")},can_coexist_with:function(a){return!this.current_state().exclusive&&!a.current_state().exclusive},can_prevail_against:function(a){return this.current_state().priority>a.current_state().priority},retreat_against:function(){this.nextDrivenState(this.current_state().retreat)}}),BetaJS.UI.Gestures.defaultGesture=function(a){return a=BetaJS.Objs.extend({mouse_up_activate:!1,wait_time:750,wait_activate:!0,disable_x:10,disable_y:10,enable_x:-1,enable_y:-1,active_priority:2},a),{Initial:{events:[{event:"ElementTriggerEvent",args:BetaJS.UI.Events.Mouse.downEvent,target:"DownState"}]},Retreat:{start:function(){this.trigger("deactivate"),this.nextDrivenState("Initial")}},DownState:{events:[{event:"BodyTriggerEvent",args:BetaJS.UI.Events.Mouse.upEvent,target:a.mouse_up_activate?"ActiveState":"Initial"},{event:"ElementMouseMoveOutEvent",args:{x:a.disable_x,y:a.disable_y},target:"Initial"},{event:"ElementMouseMoveOutEvent",args:{x:a.enable_x,y:a.enable_y},target:"ActiveState"},{event:"ElementTimerEvent",args:a.wait_time,target:a.wait_activate?"ActiveState":"Initial"}]},ActiveState:{priority:a.active_priority,exclusive:!0,start:function(){this.trigger("activate"),this.nextDrivenState("Initial")}}}};
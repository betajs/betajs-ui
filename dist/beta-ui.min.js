/*!
betajs-ui - v1.0.0 - 2014-12-02
Copyright (c) Oliver Friedmann,Victor Lingenthal
MIT Software License.
*/
BetaJS.Class.extend("BetaJS.UI.Elements.Animators",{constructor:function(a,b,c,d){this._inherited(BetaJS.UI.Elements.Animators,"constructor"),this._element=a,this._options=BetaJS.Objs.extend({callback_on_revert:!0,callback_on_complete:!0,auto_start:!0,auto_destroy:!0},b),this._callback=c,this._context=d,this._running=!1,this._options.auto_start&&this.start()},start:function(){this._running||(this._running=!0,this._start())},revert:function(){this._running&&(this._running=!1,this._revert())},complete:function(){this._running&&this._complete()},__callback:function(){this._callback.apply(this._context||this),this._options&&this._options.auto_destroy&&this.destroy()},_finished:function(){this.__callback()},_reverted:function(){this._options.callback_on_revert&&this.__callback()},_completed:function(){this._options.callback_on_complete&&this.__callback()},_start:function(){this._finished()},_revert:function(){this._reverted()},_complete:function(){this._completed()}}),BetaJS.UI.Elements.Animators.extend("BetaJS.UI.Elements.DefaultAnimator",{constructor:function(a,b,c,d){b=BetaJS.Objs.extend({duration:250,styles:{},method:"swing"},b),this._inherited(BetaJS.UI.Elements.DefaultAnimator,"constructor",a,b,c,d)},_start:function(){var a=this;this.__animate=this._element.animate(this._options.styles,this._options.duration,this._options.method,function(){a._finished()})},_revert:function(){this.__animate.stop(),this._reverted()},_complete:function(){this.__animate.stop(!0),this._completed()}}),BetaJS.Class.extend("BetaJS.UI.Elements.ElementModifier",{constructor:function(a){this._inherited(BetaJS.UI.Elements.ElementModifier,"constructor"),this._element=BetaJS.$(a),this._css={},this._cls={}},css:function(a,b){return arguments.length<2?this._element.css.apply(this._element,arguments):this._element.css(a)===b?b:(a in this._css||(this._css[a]=this._element.get(0).style[a]),this._element.css(a,b),b)},csscls:function(a,b){var c=this._element.hasClass(a);return arguments.length<2?a:c===b?b:(a in this._cls||(this._cls[a]=c),b?this._element.addClass(a):this._element.removeClass(a),b)},removeClass:function(a){this._element.hasClass(a)&&(a in this._cls||(this._cls[a]=!0),this._element.addClass(a))},revert:function(){for(var a in this._css)this._element.css(a,this._css[a]);for(a in this._cls)this._cls[a]?this._element.addClass(a):this._element.removeClass(a)}}),BetaJS.UI.Elements.Support={elementFromPoint:function(a,b,c){c=c||[],BetaJS.Types.is_array(c)||(c=[c]);for(var d=[],e=0;e<c.length;++e)c[e]=BetaJS.$(c[e]),d.push(c[e].css("z-index")),c[e].css("z-index",-1);var f=document.elementFromPoint(a-window.pageXOffset,b-window.pageYOffset);for(e=0;e<c.length;++e)c[e].css("z-index",d[e]);return f},elementBoundingBox:function(a){a=BetaJS.$(a);var b=a.offset();return{left:b.left,top:b.top,right:b.left+a.outerWidth()-1,bottom:b.top+a.outerHeight()-1}},pointWithinElement:function(a,b,c){var d=this.elementBoundingBox(c);return d.left<=a&&a<=d.right&&d.top<=b&&b<=d.bottom},childContainingElement:function(a,b){for(a=BetaJS.$(a).get(0),b=BetaJS.$(b).get(0);b.parentNode!=a;){if(b==document.body)return null;b=b.parentNode}return b}},BetaJS.UI.Events={},BetaJS.UI.Events.Support={dispatchElementEvent:function(a,b,c,d){a.dispatchEvent(new CustomEvent(b,BetaJS.Objs.extend({bubbles:!0,cancelable:!0,detail:c},d)))},dispatchElementsEvent:function(a,b,c,d){for(var e=0;e<a.length;++e)a[e].dispatchEvent(new CustomEvent(b,BetaJS.Objs.extend({bubbles:!1,cancelable:!0,detail:c},d)))},dispatchManualBubbleEvent:function(a,b,c,d,e){this.dispatchElementsEvent(BetaJS.$(a).parents().andSelf().filter(c),b,d,e)},dispatchPointsSeparatorEvent:function(a,b,c,d,e,f){c=c?BetaJS.Types.is_array(c)?c:[c]:[],d=d?BetaJS.Types.is_array(d)?d:[d]:[],this.dispatchManualBubbleEvent(a,b,function(){for(var a=0;a<c.length;++a)if(!BetaJS.UI.Elements.Support.pointWithinElement(c[a].x,c[a].y,this))return!1;for(a=0;a<d.length;++a)if(BetaJS.UI.Elements.Support.pointWithinElement(d[a].x,d[a].y,this))return!1;return!0},e,f)}},BetaJS.UI.Events.Mouse={downEvent:BetaJS.Browser.Info.isMobile()?"touchstart":"mousedown",moveEvent:BetaJS.Browser.Info.isMobile()?"touchmove":"mousemove",upEvent:BetaJS.Browser.Info.isMobile()?"touchend":"mouseup",clickEvent:BetaJS.Browser.Info.isMobile()?"touchstart":"click",customCoords:function(a,b,c){if(a.originalEvent.touches&&a.originalEvent.touches.length){var d=a.originalEvent.touches;if(c){for(var e=[],f=0;f<d.length;++f)e.push({x:d[f][b+"X"],y:d[f][b+"Y"]});return e}return{x:d[0][b+"X"],y:d[0][b+"Y"]}}var g={x:a[b+"X"],y:a[b+"Y"]};return c?[g]:g},pageCoords:function(a,b){return this.customCoords(a,"page",b)},clientCoords:function(a,b){return this.customCoords(a,"client",b)},screenCoords:function(a,b){return this.customCoords(a,"screen",b)}},BetaJS.UI.Hardware={},BetaJS.UI.Hardware.MouseCoords={__required:0,coords:{x:0,y:0},require:function(){if(0===this.__required)for(var a=this,b=[BetaJS.UI.Events.Mouse.moveEvent,BetaJS.UI.Events.Mouse.upEvent,BetaJS.UI.Events.Mouse.downEvent],c=0;c<b.length;++c)BetaJS.$("body").on(b[c]+"."+BetaJS.Ids.objectId(this),function(b){var c=BetaJS.UI.Events.Mouse.pageCoords(b);c.x&&c.y&&(a.coords=c)});this.__required++},unrequire:function(){this.__required--,0===this.__required&&BetaJS.$("body").off("."+BetaJS.Ids.objectId(this))}},BetaJS.Class.extend("BetaJS.UI.Interactions.ElementInteraction",[BetaJS.Events.EventsMixin,{constructor:function(a,b){if(this._inherited(BetaJS.UI.Interactions.ElementInteraction,"constructor"),BetaJS.UI.Hardware.MouseCoords.require(),this._element=BetaJS.$(BetaJS.$(a).get(0)),this._enabled=!1,this._options=b||{},"enabled"in this._options){var c=this._options.enabled;delete this._options.enabled,c&&BetaJS.SyncAsync.eventually(this.enable,this)}this._host=new BetaJS.States.Host,this._host.parent=this},__on:function(a,b,c,d){for(var e=this,f=b.split(" "),g=0;g<f.length;++g)BetaJS.$(a).on(f[g]+"."+BetaJS.Ids.objectId(this),function(){c.apply(d||e,arguments)})},destroy:function(){this.element().off("."+BetaJS.Ids.objectId(this)),this.disable(),this._host.destroy(),BetaJS.UI.Hardware.MouseCoords.unrequire(),this._inherited(BetaJS.UI.Interactions.ElementInteraction,"destroy")},enable:function(){this._enabled||(this._enabled=!0,this._enable())},disable:function(){this._enabled&&(this._enabled=!1,this._disable())},element:function(){return this._element},options:function(){return this._options},_enable:function(){},_disable:function(){}}],{multiple:function(a,b,c,d){var e=this;BetaJS.$(a).each(function(){var a=new e(this,b);c&&c.call(d||a,a)})}}),BetaJS.States.State.extend("BetaJS.UI.Interactions.State",{parent:function(){return this.host.parent},element:function(){return this.parent().element()},options:function(){return this.parent().options()},on:function(a,b,c,d){for(var e=this,f=b.split(" "),g=0;g<f.length;++g)BetaJS.$(a).on(f[g]+"."+BetaJS.Ids.objectId(this),function(){c.apply(d||e,arguments)})},_end:function(){this.element().off("."+BetaJS.Ids.objectId(this)),BetaJS.$("body").off("."+BetaJS.Ids.objectId(this))}}),BetaJS.UI.Interactions.ElementInteraction.extend("BetaJS.UI.Interactions.Scroll",{constructor:function(a,b){b=BetaJS.Objs.extend({discrete:!1,currentCenter:!1,currentTop:!0,scrollEndTimeout:50,whitespace:1e4,display_type:"",elementMargin:20},b),this._inherited(BetaJS.UI.Interactions.Scroll,"constructor",a,b),this._itemsElement=b.itemsElement||a,this._disableScrollCounter=0,this._host.initialize(this.cls.classname+".Idle"),this._scrollingDirection=!0,this._lastScrollTop=null,this.__on(this.element(),"scroll",function(){var a=this.element().scrollTop();null!==this._lastScrollTop&&(this._scrollingDirection=a>=this._lastScrollTop),this._lastScrollTop=a})},_whitespaceType:function(){return this.options().display_type?this.options().display_type:this.element().css("display").indexOf("flex")>=0?"flex":"default"},_whitespaceCreate:function(){var a=BetaJS.$("<whitespace></whitespace>"),b=this._whitespaceType();return"flex"==b?(a.css("display","-ms-flexbox"),a.css("display","-webkit-flex"),a.css("display","flex")):a.css("display","block"),a},_whitespaceGetHeight:function(a){return a?parseInt(a.css("height"),10):0},_whitespaceSetHeight:function(a,b){if(a){var c=this._whitespaceType();"flex"==c?(a.css("-webkit-flex","0 0 "+b+"px"),a.css("-ms-flex","0 0 "+b+"px"),a.css("flex","0 0 "+b+"px")):a.css("height",b+"px")}},itemsElement:function(){return this._itemsElement},scrollingDirection:function(){return this._scrollingDirection},currentElement:function(){var a=this.element().offset(),b=this._options.currentTop?this._options.elementMargin:this.element().innerHeight()-1-this._options.elementMargin,c=this.element().innerWidth()/2,d=BetaJS.$(BetaJS.UI.Elements.Support.elementFromPoint(a.left+c,a.top+b));for(console.log(a.left+c,a.top+b),console.log(d);d&&d.get(0)&&d.parent().get(0)!=this.itemsElement().get(0);)d=d.parent();if(!d||!d.get(0))return null;if(!this._options.currentCenter)return d;if(this._options.currentTop){var e=this.element().offset().top-d.offset().top;e>d.outerHeight()/2&&(d=d.next())}else{var f=this.element().offset().top+b-d.offset().top;f<d.outerHeight()/2&&(d=d.prev())}return d},scrollTo:function(a,b){var c=a-(this._options.currentTop?0:this.element().innerHeight()-1);b=b||{},b.scroll_top=c,this._host.state().next("ScrollingTo",b)},scrollToElement:function(a,b){var c=a.offset().top-this.element().offset().top+this.element().scrollTop();this.scrollTo(c+(this._options.currentTop?0:a.outerHeight()-1),b)},disableScroll:function(){0===this._disableScrollCounter&&this.element().css("overflow","hidden"),this._disableScrollCounter++},enableScroll:function(){this._disableScrollCounter--,0===this._disableScrollCounter&&this.element().css("overflow","scroll")},scrolling:function(){return"Idle"!=this._host.state().state_name()}}),BetaJS.UI.Interactions.State.extend("BetaJS.UI.Interactions.Scroll.Idle",{itemsElement:function(){return this.parent().itemsElement()},_start:function(){this.on(this.element(),"scroll",function(){this.next("Scrolling")})}}),BetaJS.UI.Interactions.Scroll.Idle.extend("BetaJS.UI.Interactions.Scroll.Scrolling",{_start:function(){this.__timer=null,this.on(this.element(),"scroll",function(){this._scroll(),this.parent().trigger("scroll"),clearTimeout(this.__timer);var a=this.options(),b=this;this.__timer=setTimeout(function(){b.parent().disableScroll(),b.parent().trigger("scrollend"),b._scrollend();var c=b.parent().currentElement();a.discrete&&c?b.parent().scrollToElement(c,{animate:!0,abortable:!0}):b.eventualNext("Idle")},a.scrollEndTimeout)})},_scroll:function(){},_scrollend:function(){},_end:function(){clearTimeout(this.__timer),this.parent().enableScroll(),this._inherited(BetaJS.UI.Interactions.Scroll.Scrolling,"_end")}}),BetaJS.UI.Interactions.Scroll.Idle.extend("BetaJS.UI.Interactions.Scroll.ScrollingTo",{_locals:["scroll_top","animate","abortable"],_start:function(){this._abortable||this.parent().disableScroll(),this.parent().trigger("scrollto"),this.on(this.element(),"scroll",function(){this._scroll()}),this._abortable&&(this.on(this.element(),"wheel",function(){this._moved=!0,this._abort()}),this.on(this.element(),"touchstart",function(){this._moved=!0,this._abort()})),this.suspend(),this._animate?(this._animation=new BetaJS.UI.Elements.DefaultAnimator(this.element(),{styles:{scrollTop:this._scroll_top}},this._finished,this),this._animation.start()):(this.element().scrollTop(this._scroll_top),this._finished())},_abort:function(){this._aborted||(this._aborted=!0,this._animate?(this._animation&&this._animation.complete(),this._animation=null):this._finished())},_finished:function(){this.parent().trigger("scrolltoend"),this._scrollend(),this._transitioning?this.eventualResume():(this.resume(),this.eventualNext(this._moved?"Scrolling":"Idle"))},_scroll:function(){},_scrollend:function(){},_transition:function(){this._abort()},_end:function(){this._abortable||this.parent().enableScroll(),this._inherited(BetaJS.UI.Interactions.Scroll.ScrollingTo,"_end")}}),BetaJS.UI.Interactions.ElementInteraction.extend("BetaJS.UI.Interactions.Drag",{constructor:function(a,b,c){b=BetaJS.Objs.extend({start_event:BetaJS.UI.Events.Mouse.downEvent,stop_event:BetaJS.UI.Events.Mouse.upEvent,draggable_x:!0,draggable_y:!0,clone_element:!1,drag_original_element:!1,droppable:!1,remove_element_on_drop:!1,revertable:!0},b),this._inherited(BetaJS.UI.Interactions.Drag,"constructor",a,b),this._host.initialize("BetaJS.UI.Interactions.Drag.Idle"),this._modifier=new BetaJS.UI.Elements.ElementModifier(this._element),this.data=c},destroy:function(){this._modifier.revert(),this._modifier.destroy(),this._inherited(BetaJS.UI.Interactions.Drag,"destroy")},_enable:function(){this._options.start_event&&this._element.on(this._options.start_event+"."+BetaJS.Ids.objectId(this),BetaJS.Functions.as_method(this.start,this))},_disable:function(){this._element.off("."+BetaJS.Ids.objectId(this)),this.stop()},start:function(){this._enabled&&this._host.state().next("Dragging")},stop:function(){this._enabled&&this._host.state().next("Stopping")},abort:function(){this._enabled&&this._host.state().next("Idle")},dropped:function(a){this.trigger("dropped",a),this._host.state().next("Stopping",{immediately:!0}),this._options.remove_element_on_drop&&(this.element().remove(),this.destroy())},actionable_element:function(){var a=this._host.state()._cloned_element;return a?a:this._element},modifier:function(){return this._modifier},actionable_modifier:function(){var a=this._host.state()._cloned_modifier;return a?a:this._modifier},__eventData:function(){return{element:this.element(),actionable_element:this.actionable_element(),modifier:this.modifier(),actionable_modifier:this.actionable_modifier(),source:this,data:this.data,page_coords:BetaJS.UI.Hardware.MouseCoords.coords,underneath:this.__underneath}},__triggerEvent:function(a){this.trigger(a,this.__eventData())},__triggerDomEvent:function(a){var b=this.__eventData(),c=BetaJS.UI.Elements.Support.elementFromPoint(b.page_coords.x,b.page_coords.y,this.actionable_element());c&&BetaJS.UI.Events.Support.dispatchElementEvent(c,"drag-"+a,b)},__triggerDomMove:function(){var a=this.__eventData(),b=BetaJS.UI.Elements.Support.elementFromPoint(a.page_coords.x,a.page_coords.y,this.actionable_element());b&&(this.__old_coords&&this.__underneath&&this.__underneath!=b&&(BetaJS.UI.Events.Support.dispatchPointsSeparatorEvent(b,"drag-enter",a.page_coords,this.__old_coords,a),BetaJS.UI.Events.Support.dispatchPointsSeparatorEvent(this.__underneath,"drag-leave",this.__old_coords,a.page_coords,a)),BetaJS.UI.Events.Support.dispatchElementEvent(b,"drag-hover",a)),this.__underneath=b,this.__old_coords=a.page_coords}}),BetaJS.UI.Interactions.State.extend("BetaJS.UI.Interactions.Drag.Idle",{_white_list:["Dragging"],trigger:function(a){this.parent().__triggerEvent(a)},triggerDom:function(a){this.parent().__triggerDomEvent(a)},triggerDomMove:function(){this.parent().__triggerDomMove()}}),BetaJS.UI.Interactions.Drag.Idle.extend("BetaJS.UI.Interactions.Drag.Dragging",{_white_list:["Stopping"],_persistents:["initial_element_coords","cloned_element","cloned_modifier","placeholder_cloned_element"],_start:function(){var a=this.parent().options();if(this._page_coords=BetaJS.UI.Hardware.MouseCoords.coords,a.clone_element){this._initial_element_coords={x:this.element().offset().left,y:this.element().offset().top};var b=this.element().css("z-index"),c=this.element().width(),d=this.element().height();a.drag_original_element?(this._placeholder_cloned_element=this.element().clone(),this._cloned_element=this.element().replaceWith(this._placeholder_cloned_element)):this._cloned_element=this.element().clone(),this._cloned_modifier=new BetaJS.UI.Elements.ElementModifier(this._cloned_element),this._cloned_modifier.css("position","absolute"),this._cloned_modifier.css("width",c+"px"),this._cloned_modifier.css("height",d+"px"),this._cloned_modifier.css("z-index",b+1),this._cloned_modifier.css("left",this._initial_element_coords.x+"px"),this._cloned_modifier.css("top",this._initial_element_coords.y+"px"),BetaJS.$("body").append(this._cloned_element)}else{var e=this.parent().modifier();if(e.css("position","relative"),this._initial_element_coords={},a.draggable_x){var f=e.css("left");"auto"!==f&&f||e.css("left","0px"),this._initial_element_coords.x=parseInt(e.css("left"),10)}if(a.draggable_y){var g=e.css("top");"auto"!==g&&f||e.css("top","0px"),this._initial_element_coords.y=parseInt(e.css("top"),10)}}this.trigger("start"),this.on("body",BetaJS.UI.Events.Mouse.moveEvent,this.__dragging),a.stop_event&&this.on("body",a.stop_event,function(){a.droppable&&this.triggerDom("drop"),"next"in this&&this.next("Stopping",{released:!0})})},__dragging:function(a){a.preventDefault();var b=BetaJS.UI.Events.Mouse.pageCoords(a),c={x:b.x-this._page_coords.x,y:b.y-this._page_coords.y};this._page_coords=b;var d=this.parent().actionable_modifier();this.options().draggable_x&&d.css("left",parseInt(d.css("left"),10)+c.x+"px"),this.options().draggable_y&&d.css("top",parseInt(d.css("top"),10)+c.y+"px"),this.trigger("move"),this.triggerDomMove()}}),BetaJS.UI.Interactions.Drag.Idle.extend("BetaJS.UI.Interactions.Drag.Stopping",{_white_list:["Idle"],_locals:["initial_element_coords","cloned_element","cloned_modifier","immediately","released","placeholder_cloned_element"],_start:function(){this.trigger("stopping"),this.triggerDom("stop");var a=this.options();if(!a.revertable||this._immediately)return this._released&&this.trigger("release"),void this.next("Idle");var b={};a.draggable_x&&(b.left=this._initial_element_coords.x+"px"),a.draggable_y&&(b.top=this._initial_element_coords.y+"px"),this.__animation=new BetaJS.UI.Elements.DefaultAnimator(this.parent().actionable_element(),{styles:b},function(){this.__animation&&this.next("Idle")},this),this._released&&this.trigger("release")},_end:function(){if(this.__animation){var a=this.__animation;this.__animation=null,a.complete()}this._cloned_modifier&&(this._cloned_modifier.revert(),this._cloned_modifier.destroy()),this._cloned_element&&(this._placeholder_cloned_element&&(this._cloned_element=this._placeholder_cloned_element.replaceWith(this._cloned_element)),this._cloned_element.remove()),this.parent().modifier().revert(),this.trigger("stop"),this._inherited(BetaJS.UI.Interactions.Drag.Stopping,"_end")}}),BetaJS.UI.Interactions.ElementInteraction.extend("BetaJS.UI.Interactions.Drop",{constructor:function(a,b,c){b=BetaJS.Objs.extend({droppable:function(){return!0},context:this,bounding_box:function(a){return a}},b),this._inherited(BetaJS.UI.Interactions.Drop,"constructor",a,b),this._host.initialize("BetaJS.UI.Interactions.Drop.Idle"),this._modifier=new BetaJS.UI.Elements.ElementModifier(this._element),this.data=c},destroy:function(){this._modifier.revert(),this._modifier.destroy(),this._host.destroy(),this._inherited(BetaJS.UI.Interactions.Drop,"destroy")},_enable:function(){this._host.state().next("Idle")},_disable:function(){this._host.state().next("Disabled")},modifier:function(){return this._modifier},__eventData:function(){return{element:this.element(),modifier:this.modifier(),target:this,data:this.data,source:this._host.state()._drag_source?this._host.state()._drag_source:null}},__triggerEvent:function(a){this.trigger(a,this.__eventData())},droppable:function(a){return this._options.droppable.call(this._options.context,a,this)},_is_hovering:function(a){if(!a.source.options().droppable)return!1;var b=BetaJS.UI.Elements.Support.elementBoundingBox(this.element());b=this._options.bounding_box.call(this._options.context,b);var c=a.page_coords;return b.left<=c.x&&c.x<=b.right&&b.top<=c.y&&c.y<=b.bottom}}),BetaJS.UI.Interactions.State.extend("BetaJS.UI.Interactions.Drop.Disabled",{_white_list:["Idle"],trigger:function(a){this.parent().__triggerEvent(a)}}),BetaJS.UI.Interactions.Drop.Disabled.extend("BetaJS.UI.Interactions.Drop.Idle",{_white_list:["Hover","InvalidHover","Disabled"],_start:function(){this.on(this.element(),"drag-hover",function(a){var b=a.originalEvent.detail;this.parent()._is_hovering(b)&&this.next(this.parent().droppable(b)?"Hover":"InvalidHover",{drag_source:b})})}}),BetaJS.UI.Interactions.Drop.Disabled.extend("BetaJS.UI.Interactions.Drop.Hover",{_white_list:["Idle","Disabled","Dropping"],_persistents:["drag_source"],_start:function(){this.trigger("hover"),this.on(this.element(),"drag-hover",function(a){this._drag_source=a.originalEvent.detail,this.parent()._is_hovering(this._drag_source)||this.next("Idle")}),this.on(this.element(),"drag-stop drag-leave",function(a){this._drag_source=a.originalEvent.detail,this.next("Idle")}),this.on(this.element(),"drag-drop",function(a){this._drag_source=a.originalEvent.detail,this.next("Dropping")})},_end:function(){this.trigger("unhover"),this.parent().modifier().revert(),this._inherited(BetaJS.UI.Interactions.Drop.Hover,"_end")}}),BetaJS.UI.Interactions.Drop.Disabled.extend("BetaJS.UI.Interactions.Drop.InvalidHover",{_white_list:["Idle","Disabled"],_persistents:["drag_source"],_start:function(){this.trigger("hover-invalid"),this.on(this.element(),"drag-hover",function(a){this._drag_source=a.originalEvent.detail,this.parent()._is_hovering(this._drag_source)||this.next("Idle")}),this.on(this.element(),"drag-drop drag-stop drag-leave",function(a){this._drag_source=a.originalEvent.detail,this.next("Idle")})},_end:function(){this.trigger("unhover"),this.parent().modifier().revert(),this._inherited(BetaJS.UI.Interactions.Drop.InvalidHover,"_end")}}),BetaJS.UI.Interactions.Drop.Disabled.extend("BetaJS.UI.Interactions.Drop.Dropping",{_white_list:["Idle","Disabled"],_persistents:["drag_source"],_start:function(){this.trigger("dropped"),this._drag_source.source.dropped(this.parent()),this.next("Idle")}}),BetaJS.UI.Interactions.ElementInteraction.extend("BetaJS.UI.Interactions.DropList",{constructor:function(a,b,c){b=BetaJS.Objs.extend({droppable:function(){return!0},context:this,bounding_box:function(a){return a},floater:null},b),this._inherited(BetaJS.UI.Interactions.DropList,"constructor",a,b),this._host.initialize("BetaJS.UI.Interactions.DropList.Idle"),this.data=c,this._floater=BetaJS.$(this._options.floater),this._floater.css("display","none")},destroy:function(){this._host.destroy(),this._inherited(BetaJS.UI.Interactions.DropList,"destroy")},_enable:function(){this._host.state().next("Idle")},_disable:function(){this._host.state().next("Disabled")},__eventData:function(){return{index:this._floater.index(),element:this.element(),target:this,data:this.data,source:this._host.state()._drag_source?this._host.state()._drag_source:null}},__triggerEvent:function(a){this.trigger(a,this.__eventData())},droppable:function(a){return this._options.droppable.call(this._options.context,a,this)},__update_floater:function(a){this._floater.css("display","none");var b=a.page_coords,c=BetaJS.UI.Elements.Support.childContainingElement(this.element(),a.underneath);if(c){if(c=BetaJS.$(c),c.get(0)==this._floater.get(0))return void this._floater.css("display","");var d=BetaJS.UI.Elements.Support.elementBoundingBox(c);d=this._options.bounding_box.call(this._options.context,d),d.top<=b.y&&b.y<=d.bottom||(this._floater.css("display",""),b.y<d.top?this._floater.insertBefore(c):this._floater.insertAfter(c))}},insertAt:function(a,b){var c=this.element().children().size();0>b&&(b=Math.max(0,c+1+b)),this.element().append(a),c>b&&this.element().children().eq(b).before(this.element().children().last())}}),BetaJS.UI.Interactions.State.extend("BetaJS.UI.Interactions.DropList.Disabled",{_white_list:["Idle"],trigger:function(a){this.parent().__triggerEvent(a)}}),BetaJS.UI.Interactions.DropList.Disabled.extend("BetaJS.UI.Interactions.DropList.Idle",{_white_list:["Hover","Disabled"],_start:function(){this.on(this.element(),"drag-hover",function(a){var b=a.originalEvent.detail;this.parent().droppable(b)&&this.next("Hover")})}}),BetaJS.UI.Interactions.DropList.Disabled.extend("BetaJS.UI.Interactions.DropList.Hover",{_white_list:["Idle","Disabled","Dropping"],_persistents:["drag_source"],_start:function(){this.trigger("hover"),this.on(this.element(),"drag-hover",function(a){this._drag_source=a.originalEvent.detail,this.parent().__update_floater(this._drag_source)}),this.on(this.element(),"drag-stop drag-leave",function(a){this._drag_source=a.originalEvent.detail,this.next("Idle")}),this.on(this.element(),"drag-drop",function(a){this._drag_source=a.originalEvent.detail,this.parent().__update_floater(this._drag_source),this.next("none"==this.parent()._floater.css("display")?"Idle":"Dropping")})},_end:function(){this.trigger("unhover"),this.parent()._floater.css("display","none"),this._inherited(BetaJS.UI.Interactions.DropList.Hover,"_end")}}),BetaJS.UI.Interactions.DropList.Disabled.extend("BetaJS.UI.Interactions.DropList.Dropping",{_white_list:["Idle","Disabled"],_persistents:["drag_source"],_start:function(){this.trigger("dropped"),this._drag_source.source.dropped(this.parent()),this.next("Idle")}}),BetaJS.UI.Interactions.Scroll.extend("BetaJS.UI.Interactions.InfiniteScroll",{constructor:function(a,b){b=BetaJS.Objs.extend({append_count:25,prepend_count:25,height_factor:3,whitespace_bottom:!1,context:null,append:null,prepend:null},b),this._inherited(BetaJS.UI.Interactions.InfiniteScroll,"constructor",a,b),this._can_append=!!b.append,this._can_prepend=!!b.prepend,this._extending=!1,b.prepend&&this.options().whitespace&&(this.__top_white_space=this._whitespaceCreate(),this.itemsElement().prepend(this.__top_white_space)),this.options().whitespace_bottom&&(this.__bottom_white_space=this._whitespaceCreate(),this.itemsElement().append(this.__bottom_white_space)),this.reset(!0)},append:function(a){if(this._can_append&&!this._extending){this._extending=!0;var b=this;this.options().append(a||this.options().append_count,function(a,c){b.__bottom_white_space&&b.itemsElement().append(b.__bottom_white_space),b._extending=!1,b._can_append=c,b.appended(a)})}},appendNeeded:function(){var a=this.element().get(0).scrollHeight,b=this.element().innerHeight(),c=a-(this.element().scrollTop()+b)-this._whitespaceGetHeight(this.__bottom_white_space);return c<this.options().height_factor*b},prependNeeded:function(){if(!this.options().prepend)return!1;var a=this.element().innerHeight(),b=this.element().scrollTop()-this._whitespaceGetHeight(this.__top_white_space);return b<this.options().height_factor*a},prepend:function(a){if(this._can_prepend){this._extending=!0;var b=this;this.options().prepend(a||this.options().prepend_count,function(a,c){b.__top_white_space&&b.itemsElement().prepend(b.__top_white_space),b._extending=!1,b._can_prepend=c,b.prepended(a)})}},appended:function(){},prepended:function(a){var b=this.itemsElement().find(":nth-child(2)"),c=this.itemsElement().find(":nth-child("+(1+a)+")"),d=c.offset().top-b.offset().top+c.outerHeight();this.scrolling()?this._whitespaceSetHeight(this.__top_white_space,this._whitespaceGetHeight(this.__top_white_space)-d):this.element().scrollTop(this.element().scrollTop()-d)},extendFix:function(){this.scrollingDirection()?this.appendNeeded()&&this.append():this.prependNeeded()&&this.prepend()},_whitespaceFix:function(){if(this.__top_white_space){var a=this._whitespaceGetHeight(this.__top_white_space);this._whitespaceSetHeight(this.__top_white_space,this.options().whitespace),this.element().scrollTop(this.element().scrollTop()+this.options().whitespace-a)}},reset:function(a){this._whitespaceSetHeight(this.__bottom_white_space,this.options().whitespace),this.options().prepend&&(this._whitespaceSetHeight(this.__top_white_space,this.options().whitespace),this.element().scrollTop(this.options().whitespace+(a?this.element().scrollTop():0)))}}),BetaJS.UI.Interactions.Scroll.Idle.extend("BetaJS.UI.Interactions.InfiniteScroll.Idle",{}),BetaJS.UI.Interactions.Scroll.Scrolling.extend("BetaJS.UI.Interactions.InfiniteScroll.Scrolling",{_scroll:function(){this.parent().extendFix()},_scrollend:function(){this.parent()._whitespaceFix()}}),BetaJS.UI.Interactions.Scroll.ScrollingTo.extend("BetaJS.UI.Interactions.InfiniteScroll.ScrollingTo",{_scroll:function(){this.parent().extendFix()},_scrollend:function(){this.parent()._whitespaceFix()}}),BetaJS.UI.Interactions.Scroll.extend("BetaJS.UI.Interactions.LoopScroll",{constructor:function(a,b){this._inherited(BetaJS.UI.Interactions.LoopScroll,"constructor",a,b),this.__top_white_space=this._whitespaceCreate(),this.itemsElement().prepend(this.__top_white_space),this.__bottom_white_space=this._whitespaceCreate(),this.itemsElement().append(this.__bottom_white_space),this.reset(!0)},_rotateFix:function(){var a=this._whitespaceGetHeight(this.__top_white_space),b=this._whitespaceGetHeight(this.__bottom_white_space),c=this.element().get(0).scrollHeight,d=this.element().innerHeight(),e=c-a-b,f=this.element().scrollTop(),g=this.itemsElement().children().length-2,h=(f-a)/e*g,i=(e-(f-a)-d)/e*g;if(0>h)a=f-(e-d)/2,this._whitespaceSetHeight(this.__top_white_space,a);else if(0>i)a=f-(e-d)/2,this._whitespaceSetHeight(this.__top_white_space,a);else if(i-1>h)for(;i-1>h;){var j=this.itemsElement().find(":nth-last-child(2)");j.insertAfter(this.__top_white_space),a-=j.outerHeight(),this._whitespaceSetHeight(this.__top_white_space,a),i--,h++}else if(h-1>i)for(;h-1>i;)j=this.itemsElement().find(":nth-child(2)"),j.insertBefore(this.__bottom_white_space),a+=j.outerHeight(),this._whitespaceSetHeight(this.__top_white_space,a),i++,h--},_whitespaceFix:function(){this._whitespaceSetHeight(this.__bottom_white_space,this.options().whitespace);var a=this._whitespaceGetHeight(this.__top_white_space);this._whitespaceSetHeight(this.__top_white_space,this.options().whitespace),this.element().scrollTop(this.element().scrollTop()+this.options().whitespace-a)},reset:function(a){this._whitespaceSetHeight(this.__bottom_white_space,this.options().whitespace),this._whitespaceSetHeight(this.__top_white_space,this.options().whitespace),this.element().scrollTop(this.options().whitespace+(a?this.element().scrollTop():0))}}),BetaJS.UI.Interactions.Scroll.Idle.extend("BetaJS.UI.Interactions.LoopScroll.Idle",{}),BetaJS.UI.Interactions.Scroll.Scrolling.extend("BetaJS.UI.Interactions.LoopScroll.Scrolling",{_scroll:function(){this.parent()._rotateFix()},_scrollend:function(){this.parent()._whitespaceFix()}}),BetaJS.UI.Interactions.Scroll.ScrollingTo.extend("BetaJS.UI.Interactions.LoopScroll.ScrollingTo",{_scroll:function(){this.parent()._rotateFix()},_scrollend:function(){this.parent()._whitespaceFix()}}),BetaJS.UI.Interactions.ElementInteraction.extend("BetaJS.UI.Interactions.Pinch",{constructor:function(a,b,c){b=BetaJS.Objs.extend({},b),this._inherited(BetaJS.UI.Interactions.Pinch,"constructor",a,b),this._host.initialize("BetaJS.UI.Interactions.Pinch.Idle"),this.data=c},_disable:function(){this.stop()},start:function(){this._enabled&&this._host.state().next("Pinching")},stop:function(){this._enabled&&this._host.state().next("Idle")},__eventData:function(){var a=this._host.state();return{element:this.element(),source:this,data:this.data,initial:a._initial_coords,delta_last:a._delta_last}},__triggerEvent:function(a){this.trigger(a,this.__eventData())}}),BetaJS.UI.Interactions.State.extend("BetaJS.UI.Interactions.Pinch.Idle",{_white_list:["Pinching"],trigger:function(a){this.parent().__triggerEvent(a)},_start:function(){this.on(this.element(),"touchstart",function(a){this.parent()._enabled&&a.originalEvent.touches&&2==a.originalEvent.touches.length&&this.next("Pinching",{initial_coords:BetaJS.UI.Events.Mouse.clientCoords(a,!0)})})}}),BetaJS.UI.Interactions.Pinch.Idle.extend("BetaJS.UI.Interactions.Pinch.Pinching",{_white_list:["Idle"],_persistents:["initial_coords","current_coords"],_start:function(){this._last_coords=null,this._current_coords=this._initial_coords,this.trigger("pinchstart"),this.on(this.element(),"touchmove",function(a){return a.originalEvent.touches&&2==a.originalEvent.touches.length?void this.__pinching(a):void this.next("Idle")}),this.on(this.element(),"touchend",function(){this.next("Idle")
})},_end:function(){this.trigger("pinchstop"),this._inherited(BetaJS.UI.Interactions.Pinch.Pinching,"_end")},__pinching:function(a){a.preventDefault(),this._last_coords=this._current_coords,this._current_coords=BetaJS.UI.Events.Mouse.clientCoords(a,!0),this.__compute_values(),this.trigger("pinch")},__compute_values:function(){var a=function(a,b){return a[0][b]<=a[1][b]?a[0][b]:a[1][b]},b=function(a,b){return a[0][b]>=a[1][b]?a[0][b]:a[1][b]};this._delta_last={x:a(this._last_coords,"x")-a(this._current_coords,"x")+b(this._current_coords,"x")-b(this._last_coords,"x"),y:a(this._last_coords,"y")-a(this._current_coords,"y")+b(this._current_coords,"y")-b(this._last_coords,"y")}}}),BetaJS.States.CompetingHost.extend("BetaJS.UI.Gestures.ElementStateHost",{constructor:function(a,b){this._inherited(BetaJS.UI.Gestures.ElementStateHost,"constructor",b),this._element=a},element:function(){return this._element}}),BetaJS.UI.Gestures.ElementStateHost.extend("BetaJS.UI.Gestures.Gesture",{constructor:function(a,b){var c=a.data("gestures");c||(c=new BetaJS.States.CompetingComposite,a.data("gestures",c)),this._inherited(BetaJS.UI.Gestures.Gesture,"constructor",a,c),BetaJS.UI.Hardware.MouseCoords.require();for(var d in b)b[d]=BetaJS.Objs.extend({priority:1,exclusive:!1,retreat:"Retreat"},b[d]);this.initialize("BetaJS.UI.Gestures.EventDrivenState",{state_descriptor:b,current_state:"Initial"})},destroy:function(){BetaJS.UI.Hardware.MouseCoords.unrequire(),this._inherited(BetaJS.UI.Gestures.Gesture,"destroy")}}),BetaJS.States.CompetingState.extend("BetaJS.UI.Gestures.ElementState",{_persistents:["client_pos","screen_pos"],_start:function(){this._inherited(BetaJS.UI.Gestures.ElementState,"_start"),this.on("mousemove touchmove",function(a){var b="mousemove"==a.type?a.originalEvent:a.originalEvent.touches[0];this._client_pos={x:b.clientX,y:b.clientY},this._screen_pos={x:b.screenX,y:b.screenY}})},element:function(){return this.host.element()},on:function(a,b){for(var c=this,d=a.split(" "),e=0;e<d.length;++e)this.element().on(d[e]+"."+BetaJS.Ids.objectId(this),function(a){b.call(c,a)})},_end:function(){this.element().off("."+BetaJS.Ids.objectId(this))},trigger:function(){this.host.trigger.apply(this.host,arguments)}}),BetaJS.Class.extend("BetaJS.UI.Gestures.ElementEvent",{constructor:function(a,b,c){this._inherited(BetaJS.UI.Gestures.ElementEvent,"constructor"),this._element=a,this._callback=b,this._context=c},callback:function(){this._callback&&this._callback.apply(this._context,arguments)},on:function(a,b,c,d){var e=this,f=a.split(" ");d=d||this._element;for(var g=0;g<f.length;++g)d.on(f[g]+"."+BetaJS.Ids.objectId(this),function(a){b.call(c||e,a)})},destroy:function(){this._element.off("."+BetaJS.Ids.objectId(this)),BetaJS.$("body").off("."+BetaJS.Ids.objectId(this)),this._inherited(BetaJS.UI.Gestures.ElementEvent,"destroy")}}),BetaJS.UI.Gestures.ElementEvent.extend("BetaJS.UI.Gestures.ElementTriggerEvent",{constructor:function(a,b,c,d){this._inherited(BetaJS.UI.Gestures.ElementTriggerEvent,"constructor",b,c,d),this.on(a,function(){this.callback()})}}),BetaJS.UI.Gestures.ElementEvent.extend("BetaJS.UI.Gestures.BodyTriggerEvent",{constructor:function(a,b,c,d){this._inherited(BetaJS.UI.Gestures.ElementTriggerEvent,"constructor",b,c,d),this.on(a,function(){this.callback()},this,BetaJS.$("body"))}}),BetaJS.UI.Gestures.ElementEvent.extend("BetaJS.UI.Gestures.ElementTimerEvent",{constructor:function(a,b,c,d){this._inherited(BetaJS.UI.Gestures.ElementTimerEvent,"constructor",b,c,d);var e=this;0>=a||(this._timer=setTimeout(function(){e.callback()},a))},destroy:function(){clearTimeout(this._timer),this._inherited(BetaJS.UI.Gestures.ElementTimerEvent,"destroy")}}),BetaJS.UI.Gestures.ElementEvent.extend("BetaJS.UI.Gestures.ElementMouseMoveOutEvent",{constructor:function(a,b,c,d){this._inherited(BetaJS.UI.Gestures.ElementMouseMoveOutEvent,"constructor",b,c,d);var e=BetaJS.UI.Hardware.MouseCoords.coords;console.log("Current:"+JSON.stringify(e));var f={x:0,y:0};this.on(BetaJS.UI.Events.Mouse.moveEvent,function(b){e.x||e.y||(e=BetaJS.UI.Events.Mouse.pageCoords(b));var c=BetaJS.UI.Events.Mouse.pageCoords(b);f.x=Math.max(f.x,Math.abs(e.x-c.x)),f.y=Math.max(f.y,Math.abs(e.y-c.y)),console.log(e,c,f),("x"in a&&a.x>=0&&f.x>=a.x||"y"in a&&a.y>=0&&f.y>=a.y)&&this.callback()})}}),BetaJS.UI.Gestures.ElementState.extend("BetaJS.UI.Gestures.EventDrivenState",{_persistents:["client_pos","screen_pos","state_descriptor"],_locals:["current_state"],current_state:function(){return this._state_descriptor[this._current_state]},description:function(){return this._current_state},nextDrivenState:function(a){this.next("EventDrivenState",{current_state:a})},_start:function(){function a(a){this._auto_destroy(new BetaJS.UI.Gestures[a.event](a.args,this.element(),function(){this.nextDrivenState(a.target)},this))}this._inherited(BetaJS.UI.Gestures.EventDrivenState,"_start");var b=this.current_state();b.start&&b.start.apply(this),b.events=b.events||[];for(var c=0;c<b.events.length;++c)a.call(this,b.events[c])},_end:function(){var a=this.current_state();a.end&&a.end.apply(this),this._inherited(BetaJS.UI.Gestures.EventDrivenState,"_end")},can_coexist_with:function(a){return!this.current_state().exclusive&&!a.current_state().exclusive},can_prevail_against:function(a){return this.current_state().priority>a.current_state().priority},retreat_against:function(){this.nextDrivenState(this.current_state().retreat)}}),BetaJS.UI.Gestures.defaultGesture=function(a){return a=BetaJS.Objs.extend({mouse_up_activate:!1,wait_time:750,wait_activate:!0,disable_x:10,disable_y:10,enable_x:-1,enable_y:-1,active_priority:2},a),{Initial:{events:[{event:"ElementTriggerEvent",args:BetaJS.UI.Events.Mouse.downEvent,target:"DownState"}]},Retreat:{start:function(){this.trigger("deactivate"),this.nextDrivenState("Initial")}},DownState:{events:[{event:"BodyTriggerEvent",args:BetaJS.UI.Events.Mouse.upEvent,target:a.mouse_up_activate?"ActiveState":"Initial"},{event:"ElementMouseMoveOutEvent",args:{x:a.disable_x,y:a.disable_y},target:"Initial"},{event:"ElementMouseMoveOutEvent",args:{x:a.enable_x,y:a.enable_y},target:"ActiveState"},{event:"ElementTimerEvent",args:a.wait_time,target:a.wait_activate?"ActiveState":"Initial"}]},ActiveState:{priority:a.active_priority,exclusive:!0,start:function(){this.trigger("activate"),this.nextDrivenState("Initial")}}}};
/*!
betajs-ui - v1.0.0 - 2014-10-02
Copyright (c) Oliver Friedmann,Victor Lingenthal
MIT Software License.
*/
BetaJS.Class.extend("BetaJS.UI.Elements.Animators",{constructor:function(t,e,n,i){this._inherited(BetaJS.UI.Elements.Animators,"constructor"),this._element=t,this._options=BetaJS.Objs.extend({callback_on_revert:!0,callback_on_complete:!0,auto_start:!0,auto_destroy:!0},e),this._callback=n,this._context=i,this._running=!1,this._options.auto_start&&this.start()},start:function(){this._running||(this._running=!0,this._start())},revert:function(){this._running&&(this._running=!1,this._revert())},complete:function(){this._running&&this._complete()},__callback:function(){this._callback.apply(this._context||this),this._options&&this._options.auto_destroy&&this.destroy()},_finished:function(){this.__callback()},_reverted:function(){this._options.callback_on_revert&&this.__callback()},_completed:function(){this._options.callback_on_complete&&this.__callback()},_start:function(){this._finished()},_revert:function(){this._reverted()},_complete:function(){this._completed()}}),BetaJS.UI.Elements.Animators.extend("BetaJS.UI.Elements.DefaultAnimator",{constructor:function(t,e,n,i){e=BetaJS.Objs.extend({duration:250,styles:{},method:"swing"},e),this._inherited(BetaJS.UI.Elements.DefaultAnimator,"constructor",t,e,n,i)},_start:function(){var t=this;this.__animate=this._element.animate(this._options.styles,this._options.duration,this._options.method,function(){t._finished()})},_revert:function(){this.__animate.stop(),this._reverted()},_complete:function(){this.__animate.stop(!0),this._completed()}}),BetaJS.Class.extend("BetaJS.UI.Elements.ElementModifier",{constructor:function(t){this._inherited(BetaJS.UI.Elements.ElementModifier,"constructor"),this._element=BetaJS.$(t),this._css={},this._cls={}},css:function(t,e){return 2>arguments.length?this._element.css.apply(this._element,arguments):this._element.css(t)===e?e:(t in this._css||(this._css[t]=this._element.css(t)),this._element.css(t,e),e)},csscls:function(t,e){var n=this._element.hasClass(t);return 2>arguments.length?t:n===e?e:(t in this._cls||(this._cls[t]=n),e?this._element.addClass(t):this._element.removeClass(t),e)},removeClass:function(t){this._element.hasClass(t)&&(t in this._cls||(this._cls[t]=!0),this._element.addClass(t))},revert:function(){for(var t in this._css)this._element.css(t,this._css[t]);for(t in this._cls)this._cls[t]?this._element.addClass(t):this._element.removeClass(t)}}),BetaJS.UI.Elements.Support={elementFromPoint:function(t,e,n){n=n||[],BetaJS.Types.is_array(n)||(n=[n]);for(var i=[],s=0;n.length>s;++s)n[s]=BetaJS.$(n[s]),i.push(n[s].css("z-index")),n[s].css("z-index",-1);var r=document.elementFromPoint(t-window.pageXOffset,e-window.pageYOffset);for(s=0;n.length>s;++s)n[s].css("z-index",i[s]);return r},elementBoundingBox:function(t){t=BetaJS.$(t);var e=t.offset();return{left:e.left,top:e.top,right:e.left+t.outerWidth()-1,bottom:e.top+t.outerHeight()-1}},pointWithinElement:function(t,e,n){var i=this.elementBoundingBox(n);return t>=i.left&&i.right>=t&&e>=i.top&&i.bottom>=e},childContainingElement:function(t,e){for(t=BetaJS.$(t).get(0),e=BetaJS.$(e).get(0);e.parentNode!=t;){if(e==document.body)return null;e=e.parentNode}return e}},BetaJS.UI.Events={},BetaJS.UI.Events.Support={dispatchElementEvent:function(t,e,n,i){t.dispatchEvent(new CustomEvent(e,BetaJS.Objs.extend({bubbles:!0,cancelable:!0,detail:n},i)))},dispatchElementsEvent:function(t,e,n,i){for(var s=0;t.length>s;++s)t[s].dispatchEvent(new CustomEvent(e,BetaJS.Objs.extend({bubbles:!1,cancelable:!0,detail:n},i)))},dispatchManualBubbleEvent:function(t,e,n,i,s){this.dispatchElementsEvent(BetaJS.$(t).parents().andSelf().filter(n),e,i,s)},dispatchPointsSeparatorEvent:function(t,e,n,i,s,r){n=n?BetaJS.Types.is_array(n)?n:[n]:[],i=i?BetaJS.Types.is_array(i)?i:[i]:[],this.dispatchManualBubbleEvent(t,e,function(){for(var t=0;n.length>t;++t)if(!BetaJS.UI.Elements.Support.pointWithinElement(n[t].x,n[t].y,this))return!1;for(t=0;i.length>t;++t)if(BetaJS.UI.Elements.Support.pointWithinElement(i[t].x,i[t].y,this))return!1;return!0},s,r)}},BetaJS.UI.Events.Mouse={downEvent:BetaJS.Browser.Info.isMobile()?"touchstart":"mousedown",moveEvent:BetaJS.Browser.Info.isMobile()?"touchmove":"mousemove",upEvent:BetaJS.Browser.Info.isMobile()?"touchend":"mouseup",pageCoords:function(t){return t.originalEvent.touches?{x:t.originalEvent.touches[0].pageX,y:t.originalEvent.touches[0].pageY}:{x:t.pageX,y:t.pageY}}},BetaJS.UI.Hardware={},BetaJS.UI.Hardware.MouseCoords={__required:0,coords:{x:0,y:0},require:function(){if(0===this.__required)for(var t=this,e=[BetaJS.UI.Events.Mouse.moveEvent,BetaJS.UI.Events.Mouse.upEvent,BetaJS.UI.Events.Mouse.downEvent],n=0;e.length>n;++n)BetaJS.$("body").on(e[n]+"."+BetaJS.Ids.objectId(this),function(e){t.coords=BetaJS.UI.Events.Mouse.pageCoords(e)});this.__required++},unrequire:function(){this.__required--,0===this.__required&&BetaJS.$("body").off("."+BetaJS.Ids.objectId(this))}},BetaJS.Class.extend("BetaJS.UI.Interactions.ElementInteraction",[BetaJS.Events.EventsMixin,{constructor:function(t,e){if(this._inherited(BetaJS.UI.Interactions.ElementInteraction,"constructor"),BetaJS.UI.Hardware.MouseCoords.require(),this._element=BetaJS.$(BetaJS.$(t).get(0)),this._enabled=!1,this._options=e||{},"enabled"in this._options){var n=this._options.enabled;delete this._options.enabled,n&&BetaJS.SyncAsync.eventually(this.enable,this)}this._host=new BetaJS.States.Host,this._host.parent=this},destroy:function(){this.disable(),this._host.destroy(),BetaJS.UI.Hardware.MouseCoords.unrequire(),this._inherited(BetaJS.UI.Interactions.ElementInteraction,"destroy")},enable:function(){this._enabled||(this._enabled=!0,this._enable())},disable:function(){this._enabled&&(this._enabled=!1,this._disable())},element:function(){return this._element},options:function(){return this._options},_enable:function(){},_disable:function(){}}],{multiple:function(t,e,n,i){var s=this;BetaJS.$(t).each(function(){var t=new s(this,e);n&&n.call(i||t,t)})}}),BetaJS.States.State.extend("BetaJS.UI.Interactions.State",{parent:function(){return this.host.parent},element:function(){return this.parent().element()},options:function(){return this.parent().options()},on:function(t,e,n,i){for(var s=this,r=e.split(" "),o=0;r.length>o;++o)BetaJS.$(t).on(r[o]+"."+BetaJS.Ids.objectId(this),function(){n.apply(i||s,arguments)})},_end:function(){this.element().off("."+BetaJS.Ids.objectId(this)),BetaJS.$("body").off("."+BetaJS.Ids.objectId(this))}}),BetaJS.UI.Interactions.ElementInteraction.extend("BetaJS.UI.Interactions.Drag",{constructor:function(t,e,n){e=BetaJS.Objs.extend({start_event:BetaJS.UI.Events.Mouse.downEvent,stop_event:BetaJS.UI.Events.Mouse.upEvent,draggable_x:!0,draggable_y:!0,clone_element:!1,droppable:!1,remove_element_on_drop:!1,revertable:!0},e),this._inherited(BetaJS.UI.Interactions.Drag,"constructor",t,e),this._host.initialize("BetaJS.UI.Interactions.Drag.Idle"),this._modifier=new BetaJS.UI.Elements.ElementModifier(this._element),this.data=n},destroy:function(){this._modifier.revert(),this._modifier.destroy(),this._inherited(BetaJS.UI.Interactions.Drag,"destroy")},_enable:function(){this._options.start_event&&this._element.on(this._options.start_event+"."+BetaJS.Ids.objectId(this),BetaJS.Functions.as_method(this.start,this))},_disable:function(){this._element.off("."+BetaJS.Ids.objectId(this)),this.stop()},start:function(){this._enabled&&this._host.state().next("Dragging")},stop:function(){this._enabled&&this._host.state().next("Stopping")},abort:function(){this._enabled&&this._host.state().next("Idle")},dropped:function(t){this.trigger("dropped",t),this._host.state().next("Stopping",{immediately:!0}),this._options.remove_element_on_drop&&(this.element().remove(),this.destroy())},actionable_element:function(){var t=this._host.state()._cloned_element;return t?t:this._element},modifier:function(){return this._modifier},actionable_modifier:function(){var t=this._host.state()._cloned_modifier;return t?t:this._modifier},__eventData:function(){return{element:this.element(),actionable_element:this.actionable_element(),modifier:this.modifier(),actionable_modifier:this.actionable_modifier(),source:this,data:this.data,page_coords:BetaJS.UI.Hardware.MouseCoords.coords,underneath:this.__underneath}},__triggerEvent:function(t){this.trigger(t,this.__eventData())},__triggerDomEvent:function(t){var e=this.__eventData(),n=BetaJS.UI.Elements.Support.elementFromPoint(e.page_coords.x,e.page_coords.y,this.actionable_element());n&&BetaJS.UI.Events.Support.dispatchElementEvent(n,"drag-"+t,e)},__triggerDomMove:function(){var t=this.__eventData(),e=BetaJS.UI.Elements.Support.elementFromPoint(t.page_coords.x,t.page_coords.y,this.actionable_element());e&&(this.__old_coords&&this.__underneath&&this.__underneath!=e&&(BetaJS.UI.Events.Support.dispatchPointsSeparatorEvent(e,"drag-enter",t.page_coords,this.__old_coords,t),BetaJS.UI.Events.Support.dispatchPointsSeparatorEvent(this.__underneath,"drag-leave",this.__old_coords,t.page_coords,t)),BetaJS.UI.Events.Support.dispatchElementEvent(e,"drag-hover",t)),this.__underneath=e,this.__old_coords=t.page_coords}}),BetaJS.UI.Interactions.State.extend("BetaJS.UI.Interactions.Drag.Idle",{_white_list:["Dragging"],trigger:function(t){this.parent().__triggerEvent(t)},triggerDom:function(t){this.parent().__triggerDomEvent(t)},triggerDomMove:function(){this.parent().__triggerDomMove()}}),BetaJS.UI.Interactions.Drag.Idle.extend("BetaJS.UI.Interactions.Drag.Dragging",{_white_list:["Stopping"],_persistents:["initial_element_coords","cloned_element","cloned_modifier"],_start:function(){var t=this.parent().options();if(this._page_coords=BetaJS.UI.Hardware.MouseCoords.coords,t.clone_element)this._cloned_element=this.element().clone(),this._cloned_element.css("position","absolute"),this._cloned_element.css("width",this.element().width()),this._cloned_element.css("height",this.element().height()),this._cloned_element.css("z-index",this.element().css("z-index")+1),this._initial_element_coords={x:this.element().offset().left,y:this.element().offset().top},this._cloned_element.css("left",this._initial_element_coords.x+"px"),this._cloned_element.css("top",this._initial_element_coords.y+"px"),BetaJS.$("body").append(this._cloned_element),this._cloned_modifier=new BetaJS.UI.Elements.ElementModifier(this._cloned_element);else{var e=this.parent().modifier();if(e.css("position","relative"),this._initial_element_coords={},t.draggable_x){var n=e.css("left");"auto"!==n&&n||e.css("left","0px"),this._initial_element_coords.x=parseInt(e.css("left"),10)}if(t.draggable_y){var i=e.css("top");"auto"!==i&&n||e.css("top","0px"),this._initial_element_coords.y=parseInt(e.css("top"),10)}}this.trigger("start"),this.on("body",BetaJS.UI.Events.Mouse.moveEvent,this.__dragging),t.stop_event&&this.on("body",t.stop_event,function(){t.droppable&&this.triggerDom("drop"),"next"in this&&this.next("Stopping",{released:!0})})},__dragging:function(t){t.preventDefault();var e=BetaJS.UI.Events.Mouse.pageCoords(t),n={x:e.x-this._page_coords.x,y:e.y-this._page_coords.y};this._page_coords=e;var i=this.parent().actionable_modifier();this.options().draggable_x&&i.css("left",parseInt(i.css("left"),10)+n.x+"px"),this.options().draggable_y&&i.css("top",parseInt(i.css("top"),10)+n.y+"px"),this.trigger("move"),this.triggerDomMove()}}),BetaJS.UI.Interactions.Drag.Idle.extend("BetaJS.UI.Interactions.Drag.Stopping",{_white_list:["Idle","Starting"],_locals:["initial_element_coords","cloned_element","cloned_modifier","immediately","released"],_start:function(){this.trigger("stopping"),this.triggerDom("stop");var t=this.options();if(!t.revertable||this._immediately)return this._released&&this.trigger("release"),this.next("Idle"),void 0;var e={};t.draggable_x&&(e.left=this._initial_element_coords.x+"px"),t.draggable_y&&(e.top=this._initial_element_coords.y+"px"),this.__animation=new BetaJS.UI.Elements.DefaultAnimator(this.parent().actionable_element(),{styles:e},function(){this.__animation&&this.next("Idle")},this),this._released&&this.trigger("release")},_end:function(){if(this.__animation){var t=this.__animation;this.__animation=null,t.complete()}this._cloned_modifier&&this._cloned_modifier.destroy(),this._cloned_element&&this._cloned_element.remove(),this.parent().modifier().revert(),this.trigger("stop"),this._inherited(BetaJS.UI.Interactions.Drag.Stopping,"_end")}}),BetaJS.UI.Interactions.ElementInteraction.extend("BetaJS.UI.Interactions.Drop",{constructor:function(t,e,n){e=BetaJS.Objs.extend({droppable:function(){return!0},context:this,bounding_box:function(t){return t}},e),this._inherited(BetaJS.UI.Interactions.Drop,"constructor",t,e),this._host.initialize("BetaJS.UI.Interactions.Drop.Idle"),this._modifier=new BetaJS.UI.Elements.ElementModifier(this._element),this.data=n},destroy:function(){this._modifier.revert(),this._modifier.destroy(),this._host.destroy(),this._inherited(BetaJS.UI.Interactions.Drop,"destroy")},_enable:function(){this._host.state().next("Idle")},_disable:function(){this._host.state().next("Disabled")},modifier:function(){return this._modifier},__eventData:function(){return{element:this.element(),modifier:this.modifier(),target:this,data:this.data,source:this._host.state()._drag_source?this._host.state()._drag_source:null}},__triggerEvent:function(t){this.trigger(t,this.__eventData())},droppable:function(t){return this._options.droppable.call(this._options.context,t,this)},_is_hovering:function(t){if(!t.source.options().droppable)return!1;var e=BetaJS.UI.Elements.Support.elementBoundingBox(this.element());e=this._options.bounding_box.call(this._options.context,e);var n=t.page_coords;return e.left<=n.x&&n.x<=e.right&&e.top<=n.y&&n.y<=e.bottom}}),BetaJS.UI.Interactions.State.extend("BetaJS.UI.Interactions.Drop.Disabled",{_white_list:["Idle"],trigger:function(t){this.parent().__triggerEvent(t)}}),BetaJS.UI.Interactions.Drop.Disabled.extend("BetaJS.UI.Interactions.Drop.Idle",{_white_list:["Hover","InvalidHover","Disabled"],_start:function(){this.on(this.element(),"drag-hover",function(t){var e=t.originalEvent.detail;this.parent()._is_hovering(e)&&this.next(this.parent().droppable(e)?"Hover":"InvalidHover",{drag_source:e})})}}),BetaJS.UI.Interactions.Drop.Disabled.extend("BetaJS.UI.Interactions.Drop.Hover",{_white_list:["Idle","Disabled","Dropping"],_persistents:["drag_source"],_start:function(){this.trigger("hover"),this.on(this.element(),"drag-hover",function(t){this._drag_source=t.originalEvent.detail,this.parent()._is_hovering(this._drag_source)||this.next("Idle")}),this.on(this.element(),"drag-stop drag-leave",function(t){this._drag_source=t.originalEvent.detail,this.next("Idle")}),this.on(this.element(),"drag-drop",function(t){this._drag_source=t.originalEvent.detail,this.next("Dropping")})},_end:function(){this.trigger("unhover"),this.parent().modifier().revert(),this._inherited(BetaJS.UI.Interactions.Drop.Hover,"_end")}}),BetaJS.UI.Interactions.Drop.Disabled.extend("BetaJS.UI.Interactions.Drop.InvalidHover",{_white_list:["Idle","Disabled"],_persistents:["drag_source"],_start:function(){this.trigger("hover-invalid"),this.on(this.element(),"drag-hover",function(t){this._drag_source=t.originalEvent.detail,this.parent()._is_hovering(this._drag_source)||this.next("Idle")}),this.on(this.element(),"drag-drop drag-stop drag-leave",function(t){this._drag_source=t.originalEvent.detail,this.next("Idle")})},_end:function(){this.trigger("unhover"),this.parent().modifier().revert(),this._inherited(BetaJS.UI.Interactions.Drop.InvalidHover,"_end")}}),BetaJS.UI.Interactions.Drop.Disabled.extend("BetaJS.UI.Interactions.Drop.Dropping",{_white_list:["Idle","Disabled"],_persistents:["drag_source"],_start:function(){this.trigger("dropped"),this._drag_source.source.dropped(this.parent()),this.next("Idle")}}),BetaJS.UI.Interactions.ElementInteraction.extend("BetaJS.UI.Interactions.DropList",{constructor:function(t,e,n){e=BetaJS.Objs.extend({droppable:function(){return!0},context:this,bounding_box:function(t){return t},floater:null},e),this._inherited(BetaJS.UI.Interactions.DropList,"constructor",t,e),this._host.initialize("BetaJS.UI.Interactions.DropList.Idle"),this.data=n,this._floater=BetaJS.$(this._options.floater),this._floater.css("display","none")},destroy:function(){this._host.destroy(),this._inherited(BetaJS.UI.Interactions.DropList,"destroy")},_enable:function(){this._host.state().next("Idle")},_disable:function(){this._host.state().next("Disabled")},__eventData:function(){return{index:this._floater.index(),element:this.element(),target:this,data:this.data,source:this._host.state()._drag_source?this._host.state()._drag_source:null}},__triggerEvent:function(t){this.trigger(t,this.__eventData())},droppable:function(t){return this._options.droppable.call(this._options.context,t,this)},__update_floater:function(t){this._floater.css("display","none");var e=t.page_coords,n=BetaJS.UI.Elements.Support.childContainingElement(this.element(),t.underneath);if(n){if(n=BetaJS.$(n),n.get(0)==this._floater.get(0))return this._floater.css("display",""),void 0;var i=BetaJS.UI.Elements.Support.elementBoundingBox(n);i=this._options.bounding_box.call(this._options.context,i),i.top<=e.y&&e.y<=i.bottom||(this._floater.css("display",""),e.y<i.top?this._floater.insertBefore(n):this._floater.insertAfter(n))}},insertAt:function(t,e){var n=this.element().children().size();0>e&&(e=Math.max(0,n+1+e)),this.element().append(t),n>e&&this.element().children().eq(e).before(this.element().children().last())}}),BetaJS.UI.Interactions.State.extend("BetaJS.UI.Interactions.DropList.Disabled",{_white_list:["Idle"],trigger:function(t){this.parent().__triggerEvent(t)}}),BetaJS.UI.Interactions.DropList.Disabled.extend("BetaJS.UI.Interactions.DropList.Idle",{_white_list:["Hover","Disabled"],_start:function(){this.on(this.element(),"drag-hover",function(t){var e=t.originalEvent.detail;this.parent().droppable(e)&&this.next("Hover")})}}),BetaJS.UI.Interactions.DropList.Disabled.extend("BetaJS.UI.Interactions.DropList.Hover",{_white_list:["Idle","Disabled","Dropping"],_persistents:["drag_source"],_start:function(){this.trigger("hover"),this.on(this.element(),"drag-hover",function(t){this._drag_source=t.originalEvent.detail,this.parent().__update_floater(this._drag_source)}),this.on(this.element(),"drag-stop drag-leave",function(t){this._drag_source=t.originalEvent.detail,this.next("Idle")}),this.on(this.element(),"drag-drop",function(t){this._drag_source=t.originalEvent.detail,this.parent().__update_floater(this._drag_source),this.next("none"==this.parent()._floater.css("display")?"Idle":"Dropping")})},_end:function(){this.trigger("unhover"),this.parent()._floater.css("display","none"),this._inherited(BetaJS.UI.Interactions.DropList.Hover,"_end")}}),BetaJS.UI.Interactions.DropList.Disabled.extend("BetaJS.UI.Interactions.DropList.Dropping",{_white_list:["Idle","Disabled"],_persistents:["drag_source"],_start:function(){this.trigger("dropped"),this._drag_source.source.dropped(this.parent()),this.next("Idle")}}),BetaJS.States.CompetingHost.extend("BetaJS.UI.Gestures.ElementStateHost",{constructor:function(t,e){this._inherited(BetaJS.UI.Gestures.ElementStateHost,"constructor",e),this._element=t},element:function(){return this._element}}),BetaJS.UI.Gestures.ElementStateHost.extend("BetaJS.UI.Gestures.Gesture",{constructor:function(t,e){var n=t.data("gestures");n||(n=new BetaJS.States.CompetingComposite,t.data("gestures",n)),this._inherited(BetaJS.UI.Gestures.Gesture,"constructor",t,n),BetaJS.UI.Hardware.MouseCoords.require();for(var i in e)e[i]=BetaJS.Objs.extend({priority:1,exclusive:!1,retreat:"Retreat"},e[i]);this.initialize("BetaJS.UI.Gestures.EventDrivenState",{state_descriptor:e,current_state:"Initial"})},destroy:function(){BetaJS.UI.Hardware.MouseCoords.unrequire(),this._inherited(BetaJS.UI.Gestures.Gesture,"destroy")}}),BetaJS.States.CompetingState.extend("BetaJS.UI.Gestures.ElementState",{_persistents:["client_pos","screen_pos"],_start:function(){this._inherited(BetaJS.UI.Gestures.ElementState,"_start"),this.on("mousemove touchmove",function(t){var e="mousemove"==t.type?t.originalEvent:t.originalEvent.touches[0];this._client_pos={x:e.clientX,y:e.clientY},this._screen_pos={x:e.screenX,y:e.screenY}})},element:function(){return this.host.element()},on:function(t,e){for(var n=this,i=t.split(" "),s=0;i.length>s;++s)this.element().on(i[s]+"."+BetaJS.Ids.objectId(this),function(t){e.call(n,t)})},_end:function(){this.element().off("."+BetaJS.Ids.objectId(this))},trigger:function(){this.host.trigger.apply(this.host,arguments)}}),BetaJS.Class.extend("BetaJS.UI.Gestures.ElementEvent",{constructor:function(t,e,n){this._inherited(BetaJS.UI.Gestures.ElementEvent,"constructor"),this._element=t,this._callback=e,this._context=n},callback:function(){this._callback&&this._callback.apply(this._context,arguments)},on:function(t,e,n,i){var s=this,r=t.split(" ");i=i||this._element;for(var o=0;r.length>o;++o)i.on(r[o]+"."+BetaJS.Ids.objectId(this),function(t){e.call(n||s,t)})},destroy:function(){this._element.off("."+BetaJS.Ids.objectId(this)),BetaJS.$("body").off("."+BetaJS.Ids.objectId(this)),this._inherited(BetaJS.UI.Gestures.ElementEvent,"destroy")}}),BetaJS.UI.Gestures.ElementEvent.extend("BetaJS.UI.Gestures.ElementTriggerEvent",{constructor:function(t,e,n,i){this._inherited(BetaJS.UI.Gestures.ElementTriggerEvent,"constructor",e,n,i),this.on(t,function(){this.callback()})}}),BetaJS.UI.Gestures.ElementEvent.extend("BetaJS.UI.Gestures.BodyTriggerEvent",{constructor:function(t,e,n,i){this._inherited(BetaJS.UI.Gestures.ElementTriggerEvent,"constructor",e,n,i),this.on(t,function(){this.callback()},this,BetaJS.$("body"))}}),BetaJS.UI.Gestures.ElementEvent.extend("BetaJS.UI.Gestures.ElementTimerEvent",{constructor:function(t,e,n,i){this._inherited(BetaJS.UI.Gestures.ElementTimerEvent,"constructor",e,n,i);var s=this;0>=t||(this._timer=setTimeout(function(){s.callback()},t))},destroy:function(){clearTimeout(this._timer),this._inherited(BetaJS.UI.Gestures.ElementTimerEvent,"destroy")}}),BetaJS.UI.Gestures.ElementEvent.extend("BetaJS.UI.Gestures.ElementMouseMoveOutEvent",{constructor:function(t,e,n,i){this._inherited(BetaJS.UI.Gestures.ElementMouseMoveOutEvent,"constructor",e,n,i);var s=BetaJS.UI.Hardware.MouseCoords.coords,r={x:0,y:0};this.on(BetaJS.UI.Events.Mouse.moveEvent,function(e){var n=BetaJS.UI.Events.Mouse.pageCoords(e);r.x=Math.max(r.x,Math.abs(s.x-n.x)),r.y=Math.max(r.y,Math.abs(s.y-n.y)),("x"in t&&t.x>=0&&r.x>=t.x||"y"in t&&t.y>=0&&r.y>=t.y)&&this.callback()})}}),BetaJS.UI.Gestures.ElementState.extend("BetaJS.UI.Gestures.EventDrivenState",{_persistents:["client_pos","screen_pos","state_descriptor"],_locals:["current_state"],current_state:function(){return this._state_descriptor[this._current_state]},description:function(){return this._current_state},nextDrivenState:function(t){this.next("EventDrivenState",{current_state:t})},_start:function(){function t(t){this._auto_destroy(new BetaJS.UI.Gestures[t.event](t.args,this.element(),function(){this.nextDrivenState(t.target)},this))}this._inherited(BetaJS.UI.Gestures.EventDrivenState,"_start");var e=this.current_state();e.start&&e.start.apply(this),e.events=e.events||[];for(var n=0;e.events.length>n;++n)t.call(this,e.events[n])},_end:function(){var t=this.current_state();t.end&&t.end.apply(this),this._inherited(BetaJS.UI.Gestures.EventDrivenState,"_end")},can_coexist_with:function(t){return!this.current_state().exclusive&&!t.current_state().exclusive},can_prevail_against:function(t){return this.current_state().priority>t.current_state().priority},retreat_against:function(){this.nextDrivenState(this.current_state().retreat)}}),BetaJS.UI.Gestures.defaultGesture=function(t){return t=BetaJS.Objs.extend({mouse_up_activate:!1,wait_time:750,wait_activate:!0,disable_x:10,disable_y:10,enable_x:-1,enable_y:-1,active_priority:2},t),{Initial:{events:[{event:"ElementTriggerEvent",args:BetaJS.UI.Events.Mouse.downEvent,target:"DownState"}]},Retreat:{start:function(){this.trigger("deactivate"),this.nextDrivenState("Initial")}},DownState:{events:[{event:"BodyTriggerEvent",args:BetaJS.UI.Events.Mouse.upEvent,target:t.mouse_up_activate?"ActiveState":"Initial"},{event:"ElementMouseMoveOutEvent",args:{x:t.disable_x,y:t.disable_y},target:"Initial"},{event:"ElementMouseMoveOutEvent",args:{x:t.enable_x,y:t.enable_y},target:"ActiveState"},{event:"ElementTimerEvent",args:t.wait_time,target:t.wait_activate?"ActiveState":"Initial"}]},ActiveState:{priority:t.active_priority,exclusive:!0,start:function(){this.trigger("activate"),this.nextDrivenState("Initial")}}}};
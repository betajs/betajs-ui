BetaJS.States.CompetingHost.extend("BetaJS.UI.ElementStateHost",{constructor:function(a,b){this._inherited(BetaJS.UI.ElementStateHost,"constructor",b),this._element=a},element:function(){return this._element}}),BetaJS.States.CompetingState.extend("BetaJS.UI.ElementState",{_persistents:["client_pos","screen_pos"],simulateMouseEvent:function(a){var b=document.createEvent("MouseEvents");b.initMouseEvent(a,!0,!0,window,1,this._screen_pos?this._screen_pos.x:0,this._screen_pos?this._screen_pos.y:0,this._client_pos?this._client_pos.x:0,this._client_pos?this._client_pos.y:0,!1,!1,!1,!1,0,null),this.element().get(0).dispatchEvent(b)},_start:function(){this._inherited(BetaJS.UI.ElementState,"_start"),this.on("mousemove touchmove",function(a){var b="mousemove"==a.type?a.originalEvent:a.originalEvent.touches[0];this._client_pos={x:b.clientX,y:b.clientY},this._screen_pos={x:b.screenX,y:b.screenY}})},element:function(){return this.host.element()},on:function(a,b){for(var c=this,d=a.split(" "),e=0;e<d.length;++e)this.element().on(d[e]+"."+BetaJS.Ids.objectId(this),function(a){b.call(c,a)})},_end:function(){this.element().off("."+BetaJS.Ids.objectId(this))}}),BetaJS.Class.extend("BetaJS.UI.ElementEvent",{constructor:function(a,b,c){this._inherited(BetaJS.UI.ElementEvent,"constructor"),this._element=a,this._callback=b,this._context=c},callback:function(){this._callback&&this._callback.apply(this._context,arguments)},on:function(a,b,c){for(var d=this,e=a.split(" "),f=0;f<e.length;++f)this._element.on(e[f]+"."+BetaJS.Ids.objectId(this),function(a){b.call(c||d,a)})},destroy:function(){this._element.off("."+BetaJS.Ids.objectId(this)),this._inherited(BetaJS.UI.ElementEvent,"destroy")}}),BetaJS.UI.ElementEvent.extend("BetaJS.UI.ElementTriggerEvent",{constructor:function(a,b,c,d){this._inherited(BetaJS.UI.ElementTriggerEvent,"constructor",b,c,d),this.on(a,function(){this.callback()})}}),BetaJS.UI.ElementEvent.extend("BetaJS.UI.ElementTimerEvent",{constructor:function(a,b,c,d){this._inherited(BetaJS.UI.ElementTimerEvent,"constructor",b,c,d);var e=this;this._timer=setTimeout(function(){e.callback()},a)},destroy:function(){clearTimeout(this._timer),this._inherited(BetaJS.UI.ElementTimerEvent,"destroy")}}),BetaJS.UI.ElementEvent.extend("BetaJS.UI.ElementMouseMoveOutEvent",{constructor:function(a,b,c,d){this._inherited(BetaJS.UI.ElementMouseMoveOutEvent,"constructor",b,c,d);var e=null,f=[0,0];this.on("mousemove touchmove",function(b){var c="mousemove"==b.type?b.originalEvent:b.originalEvent.touches[0],d=[c.clientX,c.clientY];e||(e=d),f[0]=Math.max(f[0],Math.abs(e[0]-d[0])),f[1]=Math.max(f[1],Math.abs(e[1]-d[1])),("x"in a&&f[0]>=a.x||"y"in a&&f[1]>=a.y)&&this.callback()})}}),BetaJS.UI.ElementState.extend("BetaJS.UI.EventDrivenState",{_persistents:["client_pos","screen_pos","state_descriptor"],_locals:["current_state"],current_state:function(){return this._state_descriptor[this._current_state]},description:function(){return this._current_state},nextDrivenState:function(a){this.next("EventDrivenState",{current_state:a})},_start:function(){function a(a){this._auto_destroy(new BetaJS.UI[a.event](a.args,this.element(),function(){this.nextDrivenState(a.target)},this))}this._inherited(BetaJS.UI.EventDrivenState,"_start");var b=this.current_state();b.start&&b.start.apply(this),b.events=b.events||[];for(var c=0;c<b.events.length;++c)a.call(this,b.events[c])},_end:function(){var a=this.current_state();a.end&&a.end.apply(this),this._inherited(BetaJS.UI.EventDrivenState,"_end")},can_coexist_with:function(a){return!this.current_state().exclusive&&!a.current_state().exclusive},can_prevail_against:function(a){return this.current_state().priority>a.current_state().priority},retreat_against:function(){this.nextDrivenState(this.current_state().retreat)}}),BetaJS.UI.Gestures={register:function(a,b){BetaJS.$(a).each(function(){var a=BetaJS.$(this),c=a.data("betajs-competing-composite");c||(c=new BetaJS.States.CompetingComposite,a.data("betajs-competing-composite",c));var d=new BetaJS.UI.ElementStateHost(a,c);d.initialize("BetaJS.UI.EventDrivenState",{state_descriptor:b,current_state:"Initial"})})}},BetaJS.UI.Gestures.clickMachine=function(a,b){return a=BetaJS.Objs.extend({disable_x:10,disable_y:10,wait_time:250},a),b=b||{},{Initial:{priority:1,exclusive:!1,retreat:"Initial",events:[{event:"ElementTriggerEvent",args:"mousedown touchstart",target:"DownState"}]},DownState:{priority:1,exclusive:!1,retreat:"Initial",events:[{event:"ElementTriggerEvent",args:"mouseup touchend",target:"ActiveState"},{event:"ElementTriggerEvent",args:"mouseup mouseleave touchend",target:"Initial"},{event:"ElementMouseMoveOutEvent",args:{x:a.disable_x,y:a.disable_y},target:"Initial"},{event:"ElementTimerEvent",args:a.wait_time,target:"Initial"}]},ActiveState:{priority:3,exclusive:!0,retreat:"Initial",start:function(){var a=this.element();b.click&&b.click.call(b.context||a,a),this.nextDrivenState("Initial")}}}},BetaJS.UI.Gestures.draggableMachine=function(a,b){return a=BetaJS.Objs.extend({wait_time:750,disable_x:10,disable_y:10,enable_x:20},a),b=b||{},{Initial:{priority:1,exclusive:!1,retreat:"Initial",start:function(){var a=this.element();b.semi_finish&&b.semi_finish.call(b.context||a,a)},events:[{event:"ElementTriggerEvent",args:"mousedown touchstart",target:"DownState"}]},DownState:{priority:2,exclusive:!1,retreat:"Initial",events:[{event:"ElementTriggerEvent",args:"mouseup mouseleave touchend",target:"Initial"},{event:"ElementMouseMoveOutEvent",args:{x:a.disable_x,y:a.disable_y},target:"Initial"},{event:"ElementTimerEvent",args:a.wait_time,target:"SemiActiveState"}]},SemiActiveState:{priority:3,exclusive:!1,retreat:"Initial",start:function(){this.on("touchmove",function(a){a.preventDefault()});var a=this.element();b.semi_start&&b.semi_start.call(b.context||a,a)},events:[{event:"ElementTriggerEvent",args:"mouseup mouseleave touchend",target:"Initial"},{event:"ElementMouseMoveOutEvent",args:{x:a.enable_x},target:"ActiveState"}]},ActiveState:{priority:4,exclusive:!0,retreat:"Initial",start:function(){var a=this.element(),c=this;a.draggable({helper:"clone",stop:function(){b.finish&&b.finish.call(b.context||a,a),a.draggable("destroy"),c.nextDrivenState("Initial")}}),this.simulateMouseEvent("mousedown"),this._client_pos.x=this._client_pos.x+1,this.simulateMouseEvent("mousemove"),this._client_pos.x=this._client_pos.x-1,this.simulateMouseEvent("mousemove"),this.on("touchmove",function(a){this.simulateMouseEvent("mousemove"),a.preventDefault()}),this.on("touchend",function(){this.simulateMouseEvent("mouseup")});var d=$(".ui-draggable-dragging");d.css("width",a.css("width")),b.start&&b.start.call(b.context||a,a)},events:[{event:"ElementTriggerEvent",args:"mouseup touchend",target:"Initial"}]}}},BetaJS.UI.Gestures.sortableMachine=function(a,b){return a=BetaJS.Objs.extend({wait_time:750,disable_x:10,disable_y:10,enable_y:20,parent_level:2},a),b=b||{},{Initial:{priority:1,exclusive:!1,retreat:"Initial",start:function(){var a=this.element();b.semi_finish&&b.semi_finish.call(b.context||a,a)},events:[{event:"ElementTriggerEvent",args:"mousedown touchstart",target:"DownState"}]},DownState:{priority:2,exclusive:!1,retreat:"Initial",events:[{event:"ElementTriggerEvent",args:"mouseup mouseleave touchend",target:"Initial"},{event:"ElementMouseMoveOutEvent",args:{x:a.disable_x,y:a.disable_y},target:"Initial"},{event:"ElementTimerEvent",args:a.wait_time,target:"SemiActiveState"}]},SemiActiveState:{priority:3,exclusive:!1,retreat:"Initial",start:function(){this.on("touchmove",function(a){a.preventDefault()});var a=this.element();b.semi_start&&b.semi_start.call(b.context||a,a)},events:[{event:"ElementTriggerEvent",args:"mouseup mouseleave touchend",target:"Initial"},{event:"ElementMouseMoveOutEvent",args:{y:a.enable_y},target:"ActiveState"}]},ActiveState:{priority:4,exclusive:!0,retreat:"Initial",start:function(){for(var c=a.parent_level,d=this.element(),e=d;c>0;)e=e.parent(),c--;e.sortable({axis:"y",revert:!0,stop:function(){b.finish&&b.finish.call(b.context||d,d),e.sortable("destroy")}}),this.on("touchmove",function(a){this.simulateMouseEvent("mousemove"),a.preventDefault()}),this.on("touchend",function(){this.simulateMouseEvent("mouseup")}),this.simulateMouseEvent("mousedown"),b.start&&b.start.call(b.context||d,d)},events:[{event:"ElementTriggerEvent",args:"mouseup touchend",target:"Initial"}]}}},BetaJS.UI.Gestures.swipeMachine=function(a,b){return a=BetaJS.Objs.extend({disable_y:20,enable_x:20},a),b=b||{},{Initial:{priority:1,exclusive:!1,retreat:"Initial",events:[{event:"ElementTriggerEvent",args:"mousedown touchstart",target:"DownState"}]},DownState:{priority:2,exclusive:!1,retreat:"Initial",events:[{event:"ElementTriggerEvent",args:"mouseup mouseleave touchend",target:"Initial"},{event:"ElementMouseMoveOutEvent",args:{y:a.disable_y},target:"Initial"},{event:"ElementMouseMoveOutEvent",args:{x:a.enable_x},target:"ActiveState"}]},ActiveState:{priority:3,exclusive:!0,retreat:"Initial",start:function(){var a=this.element();this.element().draggable({axis:"x",revert:!0,stop:function(){a.draggable("destroy")},drag:function(){b.drag&&b.drag.call(b.context||a,a)}}),this.simulateMouseEvent("mousedown"),this.on("touchmove",function(){this.simulateMouseEvent("mousemove")}),this.on("mouseleave touchend",function(){this.simulateMouseEvent("mouseup")}),this.on("mouseup",function(){b.finish&&b.finish.call(b.context||a,a)})},events:[{event:"ElementTriggerEvent",args:"mouseup mouseleave touchend",target:"Initial"}]}}};